(window.wpJsonpMaticWidget=window.wpJsonpMaticWidget||[]).push([[2],{"0lfv":function(t,e,i){"use strict";i.d(e,"i",(function(){return a})),i.d(e,"j",(function(){return c})),i.d(e,"c",(function(){return T})),i.d(e,"k",(function(){return f})),i.d(e,"a",(function(){return m})),i.d(e,"e",(function(){return v})),i.d(e,"d",(function(){return S})),i.d(e,"g",(function(){return y})),i.d(e,"h",(function(){return b})),i.d(e,"b",(function(){return x})),i.d(e,"f",(function(){return C})),i.d(e,"m",(function(){return k})),i.d(e,"l",(function(){return R}));var s=i("Kw5r"),n=i("UMHx");function a(t,e={}){return new n.a(Object.assign({bridgeURL:s.a.appConfig.walletconnect.bridgeURL,host:t},e))}var o=i("Py8h"),r=i.n(o);function c({rpc:t,chainId:e}){const i=s.a.appConfig;return new r.a({appName:i.appName,appLogoUrl:i.appLogoUrl,darkMode:!1}).makeWeb3Provider(t,e)}var d=i("jxKE"),h=i("meUc"),u=i.n(h),l=i("fYce"),p=i.n(l),g=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};class T{static isLocked(){return g(this,void 0,void 0,(function*(){try{yield T.accounts;return!1}catch(t){return!0}}))}static get accounts(){return new u.a(d.c).eth.getAccounts().then(t=>t)}static getProvider(t={}){return new p.a(window.ethereum,t)}static get defaultAddress(){return T.accounts.then(t=>{if(t&&t.length>=1)return t[0]})}static callPersonalSign(t,e,i){return new Promise((s,n)=>{i.sendAsync({method:"personal_sign",params:[e,t],from:t},(t,e)=>{const i=t||e&&e.error;i?n(i):s(e)})})}static enable(){return d.c.enable()}static getErrMessage(t,e={isHandled:!0}){return t.message.includes("WalletMiddleware")?"Please login to Metamask First":t.message.includes("MetaMask Tx Signature")?"User denied transaction from Metamask":t.message.includes("MetaMask Message Signature")?"User denied to sign from Metamask":"Address mismatch"===t.message?"Only token owner can confirm the withdrawal.":t.message.includes("execution reverted")||t.message.includes("null")||t.message.includes("JSON RPC")?"Oops our servers stumbled somewhere. We have fired off a notification to the team to investigate. Please try again after some time.":(e.isHandled=!1,t.message.substring(0,60))}}function f({networks:t,primaryProvider:e,loginStrategy:i}){let s=(()=>{switch(e){case"parent":return t.main;case"child":return t.matic}})();return(()=>{switch(i){case d.g.metaMask:return T.getProvider({url:s.rpc});case d.g.walletLink:return c({rpc:s.rpc,chainId:s.chainId});case d.g.walletConnect:return a(s.rpc);default:console.error("no loginstrategy provided")}})()}class m{constructor(t={}){this.baseUrl="",(t="string"==typeof t?{baseUrl:t}:t).baseUrl&&(this.baseUrl=t.baseUrl)}get(t="",e={}){return t=this.baseUrl+t+Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&"),fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>t.json())}post(t="",e){return t=this.baseUrl+t,fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:e?JSON.stringify(e):null}).then(t=>t.json())}}const v=function({name:t,version:e,salt:i,verifyingContract:s,nonce:n,from:a,functionSignature:o}){return{types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"verifyingContract",type:"address"},{name:"salt",type:"bytes32"}],MetaTransaction:[{name:"nonce",type:"uint256"},{name:"from",type:"address"},{name:"functionSignature",type:"bytes"}]},domain:{name:t,version:e,verifyingContract:s,salt:i},primaryType:"MetaTransaction",message:{nonce:n,from:a,functionSignature:o}}};var E=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};function S(t){return E(this,void 0,void 0,(function*(){const e=new u.a(d.c),i=e.utils.toHex(t.chainId);yield e.currentProvider.request({id:1,jsonrpc:"2.0",method:"wallet_addEthereumChain",params:[{chainId:i,chainName:t.name,rpcUrls:[t.publicRPC],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:s.a.appConfig.maticDecimals},blockExplorerUrls:[s.a.appConfig.maticExplorerUrl]}]})}))}const y=(t,e)=>{if(!t.utils.isHexStrict(e))throw new Error('Given value "'.concat(e,'" is not a valid hex string.'));const i=e.slice(0,66),s="0x".concat(e.slice(66,130));let n="0x".concat(e.slice(130,132));return n=t.utils.hexToNumber(n),[27,28].includes(n)||(n+=27),{r:i,s:s,v:n}};var w=i("kB5k");const A=new w.BigNumber(10);function b(t,e){return t.dividedBy(A.pow(new w.BigNumber(e)))}const P="polygon-widget";class x{static set(t,e){localStorage.setItem(P+t,e)}static get(t){return localStorage.getItem(P+t)}static remove(t){localStorage.removeItem(P+t)}static isExist(t){return null!=x.get(P+t)}}const C=(t,e)=>{d.i.$emit("message",{name:t,payload:e})};var I=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};function k({lable:t,actions:e,interval:i,condition:s,endHook:n}){e=e||(()=>{}),Array.isArray(e)||(e=[e]),s=s||(()=>!1),n=n||(()=>{});const a=()=>I(this,void 0,void 0,(function*(){(yield s())?(yield(t&&console.log("polling for "+t),Promise.all(e.map(t=>t()))),setTimeout(a,i)):n()}));a()}const R=t=>"true"===String(t)},"6txl":function(t,e,i){"use strict";var s=i("jxKE"),n=i("kB5k"),a=i.n(n),o=i("meUc"),r=i.n(o),c=i("0lfv"),d=i("4Ta8"),h=i.n(d),u=i("7J+i"),l=i("G0B5"),p=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},g=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};const T=new a.a(0);let f=class extends u.a{reloadTransaction(){return g(this,void 0,void 0,(function*(){this.$store.dispatch("token/fetchBalances"),yield this.$store.dispatch("transaction/fetchWithdrawals")}))}saveBurnInfo(t){return g(this,void 0,void 0,(function*(){const e=this.$store.state.widget.appInfo;yield this.$store.dispatch("transaction/saveBurnInfo",{actionTaken:!1,txHash:t.txHash,amount:t.amount,status:1,transactionStatus:s.j.INIT_PENDING,isPoS:t.isPoS,chainId:this.networks.main.chainId,tokenId:t.tokenId,wappId:e.id}),this.isLoading=!1}))}validate(){if(this.isEmpty(this.inputAmount))return this.$t("invalid.amount");const t=this.selectedToken.fullBalance(this.networkId),e=new a.a(parseFloat(this.inputAmount));return t.gte(e)?void 0:this.$t("invalid.balance")}get inputAmountWithDecimal(){console.log("this.inputAmount",this.inputAmount);const t=new a.a(this.inputAmount),e=new a.a(this.selectedToken.decimals);return t.times(s.a.pow(e)).toString(10)}validateForBurn(){return g(this,void 0,void 0,(function*(){if(!s.c)return"MetaMask is not enabled";const t=new r.a(s.c);if((yield t.eth.getChainId())!==this.maticNetwork.chainId)try{yield Object(c.d)(this.maticNetwork)}catch(t){return this.$logger.error(t),"selectMatic"}}))}handleBurnWithdrawReceiptTx(t){return g(this,void 0,void 0,(function*(){yield this.$store.dispatch("transaction/saveReceipt",t),this.reloadTransaction(),this.isLoading=!1}))}processBurnTxOnBiconomy(){return g(this,void 0,void 0,(function*(){const t=this.selectedToken.addresses[this.networkId],e=this.inputAmountWithDecimal,i=this.networkMeta.abi("ChildERC20","pos"),n=new r.a.providers.HttpProvider(this.appConfig.maticRPC),a=new r.a(n),o=a.utils.toHex(this.networkMeta.Matic.ChainId),d=a.utils.padLeft(o,64),u=yield a.eth.abi.encodeFunctionCall({name:"withdraw",type:"function",inputs:[{name:"amount",type:"uint256"}]},[e]),l=yield a.eth.abi.encodeFunctionCall({name:"getNonce",type:"function",inputs:[{name:"user",type:"address"}]},[this.address]),p=yield a.eth.call({to:t,data:l}),T=new a.eth.Contract(i,t),f=yield T.methods.name().call(),m=Object(c.e)({name:f,version:"1",salt:d,verifyingContract:t,nonce:parseInt(p),from:this.address,functionSignature:u}),v=Object(c.k)({networks:this.networks,primaryProvider:"parent",loginStrategy:this.loginStrategy});let E,S,y="";this.loginStrategy===s.g.metaMask?(E=JSON.stringify(m),y="eth_signTypedData_v3",S=new r.a(s.c)):this.loginStrategy===s.g.walletConnect?(E=JSON.stringify(m),y="eth_signTypedData",S=new r.a(v)):this.loginStrategy===s.g.walletLink&&(E=m,y="eth_signTypedData_v3",S=new r.a(v));const w=new h.a(n,{apiKey:this.appConfig.biconomyApiKey}),A=new(new r.a(w).eth.Contract)(i,t),b=[this.address,E];w.onEvent(w.READY,()=>g(this,void 0,void 0,(function*(){try{const e=(e,i)=>g(this,void 0,void 0,(function*(){if(e)return-32603===e.code?(this.error=yield this.validateForBurn(),this.error="metaTxSignError",this.isMetaTxFailed=!0):this.error=c.c.getErrMessage(e),void(this.isLoading=!1);const n={intent:i.result,fnSig:u,from:this.address,contractAddress:t};if(i.result){this.transactionStatus=s.j.INIT_PENDING;try{const{r:t,s:e,v:i}=Object(c.g)(a,n.intent);yield A.methods.executeMetaTransaction(n.from,n.fnSig,t,e,i).send({from:n.from,gas:8e5}).on("transactionHash",t=>g(this,void 0,void 0,(function*(){this.burnTxHash=t,yield this.saveBurnInfo({txHash:t,amount:this.inputAmount,tokenId:this.selectedToken.id,isPoS:!0}),yield this.reloadTransaction()}))).on("receipt",t=>g(this,void 0,void 0,(function*(){this.$logger.debug("Burn Receipt ",t),this.transactionStatus=s.j.INIT_BURNT,yield this.handleBurnWithdrawReceiptTx({txHash:t.transactionHash,blockNumber:t.blockNumber,isPoS:!0})}))).on("error",t=>{this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.INIT_FAILED,this.error=c.c.getErrMessage(t)})}catch(t){this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.INIT_FAILED,this.error=c.c.getErrMessage(t)}}}));S.currentProvider.sendAsync({method:y,params:b,from:this.address},e)}catch(t){this.$logger.error(t),this.currentStep=this.sendFlowProgressTrack.SEND_TOKEN,this.isLoading=!1,this.error=c.c.getErrMessage(t)}}))).onEvent(w.ERROR,(t,e)=>{this.transactionStatus=s.j.INIT_FAILED,this.isLoading=!1,this.error=c.c.getErrMessage(t)})}))}processBurnForPOS(t){return g(this,void 0,void 0,(function*(){if(this.error=yield this.validateForBurn(),this.error)this.isLoading=!1;else try{const e=this.selectedToken.addresses[this.networkId],i=(yield this.calculateGas("POS_WITHDRAW")).priorityGasPrice||T,n=yield this.posClient;yield n.burnERC20(e,this.inputAmountWithDecimal,{from:this.address,maxPriorityFeePerGas:i,onTransactionHash:e=>g(this,void 0,void 0,(function*(){this.burnTxHash=e,this.transactionStatus=s.j.INIT_PENDING,yield this.saveBurnInfo({txHash:e,amount:this.inputAmount,tokenId:this.selectedToken.id,isPoS:!0}),this.burnTransactionTakingTooLong&&(yield this.tryAgain(t)),yield this.reloadTransaction()})),onReceipt:t=>g(this,void 0,void 0,(function*(){this.$logger.debug("onReceipt",t),this.transactionStatus=s.j.INIT_BURNT,yield this.handleBurnWithdrawReceiptTx({txHash:t.transactionHash,blockNumber:t.blockNumber,isPoS:!0})})),onError:t=>g(this,void 0,void 0,(function*(){this.transactionStatus=s.j.INIT_FAILED,this.error=c.c.getErrMessage(t),this.isLoading=!1,this.$logger.error(t)}))})}catch(t){const e={isHandled:!1};this.error=c.c.getErrMessage(t,e),this.$logger.error(t).capture=!e.isHandled,this.isLoading=!1}}))}initBurnPos(t){return g(this,void 0,void 0,(function*(){if(this.isLoading=!0,this.error=this.validate(),this.error)this.isLoading=!1;else try{this.isPoSTransaction&&this.selectedToken.isMetaTx&&!this.isMetaTxFailed?this.processBurnTxOnBiconomy():this.processBurnForPOS(t)}catch(t){-32603===t.code?(this.error=yield this.validateForBurn(),this.isMetaTxFailed=!0):this.error=c.c.getErrMessage(t),this.$logger.error(t),this.isLoading=!1}}))}initBurnPlasma(t){return g(this,void 0,void 0,(function*(){if(this.isLoading=!0,this.error=yield this.validate(),this.error)this.isLoading=!1;else if(this.error=yield this.validateForBurn(),this.error)this.isLoading=!1;else try{if(this.isPoSTransaction)return;const e=this.selectedToken.addresses[this.networkId],i=(yield this.calculateGas("PLASMA_WITHDRAW")).priorityGasPrice||T,n=this.plasmaClient;yield n.initialize(),this.$logger.debug("withdraw initialized"),yield n.startWithdraw(e,this.inputAmountWithDecimal,{from:this.address,maxPriorityFeePerGas:i,onTransactionHash:e=>g(this,void 0,void 0,(function*(){this.$logger.debug("tx hash",e),this.burnTxHash=e,this.transactionStatus=s.j.INIT_PENDING,yield this.saveBurnInfo({txHash:e,amount:this.inputAmount,tokenId:this.selectedToken.id,isPoS:!1}),this.burnTransactionTakingTooLong&&(yield this.tryAgain(t)),yield this.reloadTransaction(),this.isLoading=!1})),onReceipt:t=>g(this,void 0,void 0,(function*(){this.$logger.debug("onReceipt",t),this.transactionStatus=s.j.INIT_BURNT,yield this.handleBurnWithdrawReceiptTx({txHash:t.transactionHash,blockNumber:t.blockNumber,isPoS:!1}),this.isLoading=!1})),onError:t=>g(this,void 0,void 0,(function*(){this.$logger.error(t),this.burnTransactionTakingTooLong||(this.transactionStatus=s.j.INIT_FAILED),this.isLoading=!1,this.error=c.c.getErrMessage(t)}))})}catch(t){const e={isHandled:!1};this.error=c.c.getErrMessage(t,e),this.$logger.error(t).capture=!e.isHandled,this.isLoading=!1}}))}tryAgain(t){return g(this,void 0,void 0,(function*(){yield this.$store.dispatch("transaction/updateActionRequired",{txHash:t,payload:{transactionStatus:s.j.ALTERED_EXTERNALLY}}),this.burnTransactionTakingTooLong=!1}))}};f=p([l.a],f);var m=f,v=i("Kw5r"),E=i("gnxY"),S=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},y=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};let w=class extends v.a{checkForExit(){return y(this,void 0,void 0,(function*(){const t=this.burnTxHash,e=yield this.mntApiCall();if(e&&1===e.status)this.isPoSTransaction?(this.transactionStatus=s.j.COMPLETE_SUCCESS,yield this.$store.dispatch("transaction/updateActionRequired",{txHash:t,payload:{transactionStatus:s.j.COMPLETE_SUCCESS,exitTxHash:e.result}})):(this.transactionStatus=s.j.CONFIRM_SUCCESS,yield this.$store.dispatch("transaction/updateActionRequired",{txHash:t,payload:{transactionStatus:s.j.CONFIRM_SUCCESS,relatedTxHash:e.result}}));else{const e=v.a.service.transaction.getActionRequiredTxDoc(t);yield e.update({tempTimestamp:v.a.service.transaction.serverTimeStamp});const i=yield e.get();i.get("tempTimestamp").seconds>i.get("updatedAt").seconds+s.h&&(this.withdrawStatusList&&this.withdrawStatusList[t]&&(this.withdrawStatusList[t].code===s.j.CONFIRM_PENDING||this.withdrawStatusList[t].code===s.j.COMPLETE_PENDING)?this.takesTooLong=!0:this.withdrawStatusList&&this.withdrawStatusList[t]&&this.withdrawStatusList[t].code===s.j.INIT_PENDING&&(this.burnTransactionTakingTooLong=!0))}}))}mntApiCall(){return y(this,void 0,void 0,(function*(){return yield this.$store.dispatch("transaction/statusFromBlockchainForWithdrawal",{burnTransactionHash:this.burnTxHash,isPos:this.isPoSTransaction})}))}getWithdrawProof(t){return y(this,void 0,void 0,(function*(){try{return this.burnTxHash?yield this.$store.dispatch("transaction/getWithdrawProof",{burnTxHash:this.burnTxHash,eventSign:t}):null}catch(t){this.$logger.error(t).capture=!0}}))}validateForExit(){return y(this,void 0,void 0,(function*(){if(!s.c)return"Metamask is not enabled";const t=new r.a(s.c);return(yield t.eth.getChainId())!==this.mainNetwork.chainId?"selectMain":void 0}))}saveConfirmWithdraw(t){return y(this,void 0,void 0,(function*(){this.$store.dispatch("transaction/saveConfirmWithdraw",t),this.isLoading=!1}))}saveExitWithdrawTx(t){return y(this,void 0,void 0,(function*(){yield this.$store.dispatch("transaction/saveExitWithdrawTx",t),this.isLoading=!1}))}saveExitWithdraw(t){return y(this,void 0,void 0,(function*(){yield this.$store.dispatch("transaction/saveExitWithdraw",t),this.isLoading=!1}))}checkUserAddressForConfirm(t){return y(this,void 0,void 0,(function*(){const e=new r.a.providers.HttpProvider(this.maticNetwork.rpc),i=new r.a(e);return(yield i.eth.getTransaction(t)).from.toLowerCase()===this.address.toLowerCase()}))}initConfirmWithdraw(){return y(this,void 0,void 0,(function*(){if(this.isLoading=!0,this.error=yield this.validateForExit(),this.error)this.isLoading=!1;else{if(!(yield this.checkUserAddressForConfirm(this.burnTxHash)))return this.error=c.c.getErrMessage({message:"Address mismatch"}),this.$logger.error(this.error),void(this.isLoading=!1);try{if(!this.isPoSTransaction&&this.burnTxHash){const t="0xebff2602b3f468259e1e99f613fed6691f3a6526effe6ef3e768ba7ae7a36c4f",[e,i,n]=yield Promise.all([this.mntApiCall(),this.getWithdrawProof(t),this.calculateGas("PLASMA_CONFIRM_WITHDRAW")]),o=n.priorityGasPrice;if(e&&1===e.status)return void(yield this.$store.dispatch("transaction/updateActionRequired",{txHash:this.burnTxHash,payload:{transactionStatus:s.j.CONFIRM_SUCCESS,relatedTxHash:e.result}}));if(this.$logger.debug("confirm withdraw initialized"),Object(c.f)(E.a.confirmWithdrawInit,{}),i){const t=Object(c.k)({networks:this.networks,primaryProvider:"parent",loginStrategy:this.loginStrategy}),e=new r.a(t),n=this.networkMeta.abi("ERC20PredicateBurnOnly"),d=this.networks.main.contracts.ERC20Predicate,h=new e.eth.Contract(n,d),u=new r.a.providers.HttpProvider(this.appConfig.mainRPC),l=new r.a(u),p=l.eth.abi.encodeFunctionCall({name:"startExitWithBurntTokens",type:"function",inputs:[{type:"bytes",name:"inputData"}]},[i]);let g=new a.a(yield l.eth.estimateGas({to:d,from:this.address,data:p}));g=g.plus(1e5),yield h.methods.startExitWithBurntTokens(i).send({from:this.address,gas:g,maxPriorityFeePerGas:o}).on("transactionHash",t=>y(this,void 0,void 0,(function*(){this.withdrawStatusList[this.burnTxHash].code=s.j.CONFIRM_PENDING,this.burnTransactionTakingTooLong=!1,this.transactionStatus=s.j.CONFIRM_PENDING,yield this.saveConfirmWithdraw({burnTxHash:this.burnTxHash,txHash:t,isPoS:!1,status:this.transactionStatus}),this.takesTooLong=!1,Object(c.f)(E.a.confirmWithdrawComplete,{}),yield this.reloadTransaction(),this.$logger.debug("confirm withdraw initialized completed")}))).on("error",(t,e)=>{this.isLoading=!1,this.error=c.c.getErrMessage(t),this.transactionStatus=s.j.CONFIRM_FAILED,this.$logger.debug("confirm withdraw failed")}),this.isLoading=!1}else{const t=this.plasmaClient;yield t.initialize(),yield t.withdraw(this.burnTxHash,{from:this.address,maxPriorityFeePerGas:o,onTransactionHash:t=>y(this,void 0,void 0,(function*(){this.withdrawStatusList[this.burnTxHash].code=s.j.CONFIRM_PENDING,this.burnTransactionTakingTooLong=!1,this.transactionStatus=s.j.CONFIRM_PENDING,yield this.saveConfirmWithdraw({burnTxHash:this.burnTxHash,txHash:t,isPoS:!1,status:this.transactionStatus}),this.takesTooLong=!1,Object(c.f)(E.a.confirmWithdrawComplete,{}),yield this.reloadTransaction(),this.isLoading=!1,this.$logger.debug("confirm withdraw initialized completed")})),onError:t=>y(this,void 0,void 0,(function*(){this.$logger.error(t),this.isLoading=!1,this.error=c.c.getErrMessage(t),this.transactionStatus=s.j.CONFIRM_FAILED,Object(c.f)(E.a.confirmWithdrawError,this.error)}))})}}}catch(t){this.error=c.c.getErrMessage(t),this.$logger.error(t),this.isLoading=!1,Object(c.f)(E.a.confirmWithdrawError,this.error)}}}))}initPosExit(){return y(this,void 0,void 0,(function*(){if(this.isLoading=!0,this.error=yield this.validateForExit(),this.error)this.isLoading=!1;else try{if(this.isPoSTransaction&&this.burnTxHash){const t=this.selectedToken.burnEventSignature||"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",[e,i,n]=yield Promise.all([this.mntApiCall(),this.getWithdrawProof(t),this.calculateGas("POS_EXIT")]),o=n.priorityGasPrice;if(e&&1===e.status)return void(yield this.$store.dispatch("transaction/updateActionRequired",{txHash:this.burnTxHash,payload:{transactionStatus:s.j.COMPLETE_SUCCESS,exitTxHash:e.result}}));if(this.$logger.debug("pos withdraw exit initialized"),Object(c.f)(E.a.exitInit,{}),i){const t=Object(c.k)({networks:this.networks,primaryProvider:"parent",loginStrategy:this.loginStrategy}),e=new r.a(t),n=this.networkMeta.abi("RootChainManager","pos"),d=this.networks.main.posContracts.RootChainManagerProxy,h=new e.eth.Contract(n,d),u=new r.a.providers.HttpProvider(this.appConfig.mainRPC),l=new r.a(u),p=l.eth.abi.encodeFunctionCall({name:"exit",type:"function",inputs:[{type:"bytes",name:"inputData"}]},[i]);let g=new a.a(yield l.eth.estimateGas({to:d,from:this.address,data:p}));g=g.plus(1e5),yield h.methods.exit(i).send({from:this.address,gas:g,maxPriorityFeePerGas:o}).on("transactionHash",t=>y(this,void 0,void 0,(function*(){this.transactionStatus=s.j.COMPLETE_PENDING,this.txFromExternalApplication||(this.withdrawStatusList[this.burnTxHash].code=s.j.COMPLETE_PENDING,this.burnTransactionTakingTooLong=!1,yield this.saveExitWithdrawTx({burnTxHash:this.burnTxHash,txHash:t,isPoS:!0,status:this.transactionStatus}),this.takesTooLong=!1,Object(c.f)(E.a.exitComplete,{}),yield this.reloadTransaction())}))).on("receipt",t=>y(this,void 0,void 0,(function*(){this.txFromExternalApplication&&(this.$logger.debug("onReceipt",t),this.transactionStatus=s.j.COMPLETE_SUCCESS)}))).on("error",(t,e)=>{this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.COMPLETE_FAILED,this.error=c.c.getErrMessage(t),Object(c.f)(E.a.exitError,this.error)})}else{const t=yield this.posClient;if(yield t.isERC20ExitProcessed(this.burnTxHash))return void(this.txFromExternalApplication||(yield this.saveExitWithdraw({burnTxHash:this.burnTxHash,status:s.j.COMPLETE_SUCCESS})));yield t.exitERC20(this.burnTxHash,{from:this.address,maxPriorityFeePerGas:o,onTransactionHash:t=>y(this,void 0,void 0,(function*(){this.transactionStatus=s.j.COMPLETE_PENDING,this.txFromExternalApplication||(this.withdrawStatusList[this.burnTxHash].code=s.j.COMPLETE_PENDING,this.burnTransactionTakingTooLong=!1,yield this.saveExitWithdrawTx({burnTxHash:this.burnTxHash,txHash:t,isPoS:!0,status:this.transactionStatus}),this.takesTooLong=!1,Object(c.f)(E.a.exitComplete,{}),yield this.reloadTransaction())})),onReceipt:t=>y(this,void 0,void 0,(function*(){this.txFromExternalApplication&&(this.$logger.debug("onReceipt",t),this.transactionStatus=s.j.COMPLETE_SUCCESS)})),onError:t=>y(this,void 0,void 0,(function*(){this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.COMPLETE_FAILED,this.error=c.c.getErrMessage(t),Object(c.f)(E.a.exitError,this.error)}))})}}}catch(t){this.error=c.c.getErrMessage(t),this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.COMPLETE_FAILED,Object(c.f)(E.a.exitError,this.error)}}))}initPlasmaExit(){return y(this,void 0,void 0,(function*(){if(this.isLoading=!0,this.error=yield this.validateForExit(),this.error)this.isLoading=!1;else if(!this.isPoSTransaction)try{Object(c.f)(E.a.exitInit,{});const t=this.selectedToken.addresses[this.mainNetwork.chainId],e=yield this.plasmaClient;yield e.initialize();const i=yield this.processExitPosition(this.burnTxHash),n=(yield this.calculateGas("PLASMA_PROCESS_EXIT")).priorityGasPrice,a=25e4*i;yield e.processExits(t,{from:this.address,maxPriorityFeePerGas:n,gas:a,onTransactionHash:t=>y(this,void 0,void 0,(function*(){this.transactionStatus=s.j.COMPLETE_PENDING,this.txFromExternalApplication||(yield this.saveExitWithdrawTx({burnTxHash:this.burnTxHash,txHash:t,isPoS:!1,status:this.transactionStatus}),yield this.reloadTransaction(),Object(c.f)(E.a.exitComplete,{}))})),onReceipt:t=>y(this,void 0,void 0,(function*(){this.txFromExternalApplication&&(this.$logger.debug("onReceipt",t),this.transactionStatus=s.j.COMPLETE_SUCCESS)})),onError:t=>y(this,void 0,void 0,(function*(){this.$logger.error(t),this.isLoading=!1,this.transactionStatus=s.j.COMPLETE_FAILED,this.error=c.c.getErrMessage(t),Object(c.f)(E.a.exitError,this.error)}))})}catch(t){this.error=c.c.getErrMessage(t),this.$logger.error(t),this.transactionStatus=s.j.COMPLETE_FAILED,this.isLoading=!1,Object(c.f)(E.a.exitError,this.error)}}))}processExitPosition(t){return y(this,void 0,void 0,(function*(){try{const e=yield this.$store.dispatch("transaction/statusFromBlockchainForPlasmaExitPosition",{burnTransactionHash:t});if(e&&e.success&&e.result&&e.result.plasmaExitsBefore>=0){const t=e.result.plasmaExitsBefore;return t<3?3:t>=5?5:t+1}return 3}catch(t){return 3}}))}};w=S([l.a],w);var A=w;e.a=[m,A]},"7J+i":function(t,e,i){"use strict";var s=i("Kw5r"),n=i("0lfv"),a=i("YK/6"),o=i.n(a),r=i("L+H0"),c=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o};let d=class extends s.a{get posClient(){const t=Object(n.k)({networks:this.networks,primaryProvider:"parent",loginStrategy:this.loginStrategy}),e=Object(n.k)({networks:this.networks,primaryProvider:"child",loginStrategy:this.loginStrategy});return new o.a.MaticPOSClient({network:this.appConfig.matic.network,version:this.appConfig.matic.version,parentProvider:t,maticProvider:e,posRootChainManager:this.networkMeta.Main.POSContracts.RootChainManagerProxy,posERC20Predicate:this.networkMeta.Main.POSContracts.ERC20PredicateProxy,posERC721Predicate:this.networkMeta.Main.POSContracts.ERC721PredicateProxy})}get plasmaClient(){const t=Object(n.k)({networks:this.networks,primaryProvider:"parent",loginStrategy:this.loginStrategy}),e=Object(n.k)({networks:this.networks,primaryProvider:"child",loginStrategy:this.loginStrategy});return new o.a({network:this.appConfig.matic.network,version:this.appConfig.matic.version,parentProvider:t,maticProvider:e})}};d=c([r.b],d),e.a=d},A3pM:function(t,e,i){"use strict";var s=i("Kw5r"),n=i("S7WH"),a=i("twk0"),o=i.n(a),r=i("L+H0"),c=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},d=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};let h=class extends s.a{initWidget(t){return d(this,void 0,void 0,(function*(){const e=s.a.appConfig;return yield this.getWidgetApp(Object.assign(Object.assign({},t),{network:new o.a(e.matic.network,e.matic.version)}))}))}initWidgetTokens(){return d(this,void 0,void 0,(function*(){this.$store.getters["widget/wappDetails"]}))}};c([Object(n.a)("widget/getApp")],h.prototype,"getWidgetApp",void 0),h=c([r.b],h);var u=h;e.a=[u]},BhN1:function(t,e,i){"use strict";i.d(e,"a",(function(){return C}));var s=i("meUc"),n=i.n(s),a={SET_MAIN(t,e){t.main=e},SET_MATIC(t,e){t.matic=e},SET_HEIMDALL(t,e){t.heimdall=e},SET_MAIN_PROVIDER(t,e){t.main.web3=new n.a(e),t.main.provider=e},SET_MATIC_PROVIDER(t,e){t.matic.web3=new n.a(e),t.matic.provider=e},EXTEND_MAIN_ETH(t,e){t.main.web3.eth.extend(e)},EXTEND_MATIC_ETH(t,e){t.matic.web3.eth.extend(e)}},o=i("twk0"),r=i.n(o),c=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},d={setNetwork({commit:t,rootState:e},{appConfig:i}){const s=e.widget.appInfo.rpc||i.mainRPC,n=new r.a(i.matic.network,i.matic.version);let a=n.Main,o=n.Matic,c=n.Heimdall||{};const d={key:"main",id:a.ChainId,chainId:a.ChainId,networkId:a.ChainId,name:a.NetworkName,historyHost:a.Explorer,childNetworkId:o.ChainId,rpc:s,isMatic:!1,syncerUrl:a.SyncerAPI,watcherUrl:a.WatcherAPI,daggerEndpoint:a.DaggerEndpoint,contracts:Object.assign({},a.Contracts),posContracts:Object.assign({},a.POSContracts)},h={key:"matic",id:o.ChainId,chainId:o.ChainId,networkId:o.ChainId,name:o.NetworkName,parentNetworkId:a.ChainId,historyHost:o.Explorer,rpc:i.maticRPC,publicRPC:o.RPC,isMatic:!0,default:!0,syncerUrl:o.SyncerAPI,watcherUrl:o.WatcherAPI,daggerEndpoint:o.daggerEndpoint,contracts:Object.assign({},o.Contracts)},u={chainId:c.ChainId,api:c.API};t("SET_MAIN",d),t("SET_MATIC",h),t("SET_HEIMDALL",u)},setProviders({state:t,dispatch:e,commit:i},s){return c(this,void 0,void 0,(function*(){i("SET_MAIN_PROVIDER",s.main),i("SET_MATIC_PROVIDER",s.matic),i("EXTEND_MAIN_ETH",{methods:[{name:"signTypedDataLegacy",call:"eth_signTypedDataLegacy",params:2}]}),i("EXTEND_MATIC_ETH",{methods:[{name:"signTypedDataLegacy",call:"eth_signTypedDataLegacy",params:2}]})}))}},h=i("Kw5r"),u={namespaced:!0,state:{main:null,matic:null,heimdall:null},mutations:a,actions:d,getters:{networks:t=>({main:t.main,matic:t.matic,heimdal:t.heimdall}),metaInfo:()=>new r.a(h.a.appConfig.matic.network,h.a.appConfig.matic.version)}},l={SET_USER(t,e){t.user=e},SET_LOGIN_STRATEGY(t,e){t.loginStrategy=e}},p=i("jxKE"),g=i("0lfv"),T=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},f={namespaced:!0,state:{loginStrategy:null,user:null},mutations:l,actions:{initUser({commit:t},e){return T(this,void 0,void 0,(function*(){t("SET_USER",e)}))},initAuthentication({dispatch:t,commit:e}){return T(this,void 0,void 0,(function*(){const i=g.b.get(p.f.loginStrategy);e("SET_LOGIN_STRATEGY",i);if(!(yield h.a.service.user.authorizedUser))return!1;{const e=yield h.a.service.firebase.activeUser;t("initUser",{address:null==e?void 0:e.uid})}}))},logout({commit:t}){return T(this,void 0,void 0,(function*(){t("SET_USER",null),t("transaction/CLEAR_ALL_TRANSACTIONS",[],{root:!0}),t("token/SET_ERC20TOKENS",[],{root:!0}),yield h.a.service.firebase.logout(),h.a.$logger.stopTrack()}))},login({commit:t,dispatch:e,state:i},s){return T(this,void 0,void 0,(function*(){s.isAndroid=!0;const{customToken:n}=yield h.a.service.user.login(s);return g.b.set(p.f.loginStrategy,s.strategy),t("SET_LOGIN_STRATEGY",s.strategy),n&&(yield h.a.service.firebase.signInWithCustomToken(n),yield e("initAuthentication"),h.a.$logger.initTrack(i.user)),null}))}},getters:{isWCConnected:t=>t.loginStrategy===p.g.walletConnect,isMetaMaskConnected:t=>t.loginStrategy===p.g.metaMask,isWalletLinkConnected:t=>t.loginStrategy===p.g.walletLink,address:t=>t.user.address,isAuthenticated:t=>!!t.user}},m=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},v={namespaced:!0,state:{appInfo:null,selectedAmount:null,selectedPage:null,widgetDisabled:!1},mutations:{SET_APP_INFO(t,e){t.appInfo=e},SET_SELECTED_AMOUNT(t,e){"undefined"!=e&&(t.selectedAmount=e)},SET_SELECTED_PAGE(t,e){"undefined"!=e&&(t.selectedPage=e)},SET_WIDGET_DISABLED(t,e){"undefined"!=e&&(t.widgetDisabled=e)}},actions:{getApp({commit:t},{appId:e,amount:i,page:s,network:n}){return m(this,void 0,void 0,(function*(){t("SET_SELECTED_AMOUNT",(i||"").toString()),t("SET_SELECTED_PAGE",s);let a=yield h.a.service.firebase.configs();if(a&&a.exists){const e=a.data().WIDGET_DISABLED;t("SET_WIDGET_DISABLED",e)}let o=yield h.a.service.firebase.widgetAppsRef(e).get();if(o=o.docs[0],o&&o.exists){const i=o.data()||{};return i.id=e,n.Main.RPC=i.rpc,i.network=n,i.network.Main.id=i.network.Main.chainId,i.network.Matic.id=i.network.Matic.chainId,i.defaultToken=i.defaultToken||[],t("SET_APP_INFO",i),!0}return!1}))}},getters:{defaultToken:t=>t.appInfo.defaultToken[0]}},E=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},S={namespaced:!0,state:{withdrawals:[],approvals:[],deposits:[],stuckTransactions:[],withdrawStatusList:[],approveStatusList:[],depositStatusList:[],withdrawMetadata:{count:0,text:""},approveMetadata:{count:0,text:""},depositMetadata:{count:0,text:""},withdrawalStatusLoading:!1},mutations:{SET_APPROVALS(t,e){t.approvals=e},SET_DEPOSITS(t,e){t.deposits=e},SET_WITHDRAWALS(t,e){t.withdrawals=e},SET_STUCK_TRANSACTIONS(t,e){t.stuckTransactions=e},SET_WITHDRAW_STATUS_LIST(t,e){t.withdrawStatusList=e},SET_WITHDRAW_METADATA(t,e){t.withdrawMetadata.count=e.count,t.withdrawMetadata.text=e.text},SET_APPROVE_STATUS_LIST(t,e){t.approveStatusList=e},SET_APPROVE_METADATA(t,e){t.approveMetadata=e},SET_DEPOSIT_STATUS_LIST(t,e){t.depositStatusList=e},SET_DEPOSIT_METADATA(t,e){t.depositMetadata=e},SET_WITHDRAWAL_STATUS_LOADING(t,e){t.withdrawalStatusLoading=e},UPDATE_WITHDRAW_STATUS(t,{burnTxHash:e,status:i}){t.withdrawStatusList[e].code=i},CLEAR_ALL_TRANSACTIONS(t){t.withdrawals=[],t.approvals=[],t.deposits=[],t.stuckTransactions=[],t.withdrawStatusList=[],t.approveStatusList=[],t.depositStatusList=[],t.withdrawMetadata={count:0,text:""},t.approveMetadata={count:0,text:""},t.depositMetadata={count:0,text:""}}},actions:{approveTransaction:({},t)=>h.a.service.transaction.approveTransaction(t),depositTransaction:({},t)=>h.a.service.transaction.depositTransaction(t),checkForExit({},t){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.exitTransaction({burnTransactionHash:t.txHash,isPos:t.isPoS});if(1===e.status)return h.a.service.transaction.updateActionRequired(t.txHash,{transactionStatus:t.transactionStatus,exitTxHash:e.result})}))},saveBurnInfo:({},t)=>h.a.service.transaction.setActionRequired(t),saveReceipt:({},t)=>h.a.service.transaction.updateActionRequired(t.txHash,{blockNumber:t.blockNumber}),saveConfirmWithdraw:({commit:t},e)=>(t("UPDATE_WITHDRAW_STATUS",e),h.a.service.transaction.updateActionRequired(e.burnTxHash,{relatedTxHash:e.txHash,actionTaken:!0,status:3,transactionStatus:e.status})),saveExitWithdrawTx:({commit:t},e)=>(t("UPDATE_WITHDRAW_STATUS",e),h.a.service.transaction.updateActionRequired(e.burnTxHash,{exitTxHash:e.txHash,transactionStatus:e.status})),saveExitWithdraw:({commit:t},e)=>(t("UPDATE_WITHDRAW_STATUS",e),h.a.service.transaction.updateActionRequired(e.burnTxHash,{transactionStatus:p.j.COMPLETE_SUCCESS})),fetchApprovals({commit:t}){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.fetchApprovals();t("SET_APPROVALS",e)}))},fetchDeposits({commit:t}){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.fetchDeposits();t("SET_DEPOSITS",e)}))},fetchWithdrawals({commit:t}){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.fetchWithdrawals();t("SET_WITHDRAWALS",e)}))},fetchStuckTransactions({commit:t}){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.fetchStuckTransactions();t("SET_STUCK_TRANSACTIONS",e)}))},fetchWithdrawalsStatus({commit:t,state:e,dispatch:i,rootState:s},n){return E(this,void 0,void 0,(function*(){const{withdrawTxStatus:s,count:a,action:o}=yield h.a.service.bridge.withdrawTxStatus(n);s&&(t("SET_WITHDRAW_STATUS_LIST",s),t("SET_WITHDRAW_METADATA",{count:a,text:o}));const r=e.stuckTransactions;s&&(yield h.a.service.bridge.updateSuccessAndStuckWithdrawTx(s,r),i("fetchWithdrawals"))}))},fetchApprovalsStatus({commit:t,dispatch:e},i){return E(this,void 0,void 0,(function*(){const{approvalTxStatus:s,count:n,action:a}=yield h.a.service.bridge.approvalTxStatus(i);s&&(t("SET_APPROVE_STATUS_LIST",s),t("SET_APPROVE_METADATA",{count:n,text:a}),yield h.a.service.bridge.updateSuccessAndFailedApprovalTx(s),e("fetchApprovals"))}))},fetchDepositsStatus({commit:t,dispatch:e},i){return E(this,void 0,void 0,(function*(){const{depositTxStatus:s,count:n,action:a}=yield h.a.service.bridge.depositTxStatus(i);s&&(t("SET_DEPOSIT_STATUS_LIST",s),t("SET_DEPOSIT_METADATA",{count:n,text:a}),yield h.a.service.bridge.updateSuccessAndFailedDepositTx(s),e("fetchDeposits"))}))},getWithdrawProof({},t){return E(this,void 0,void 0,(function*(){const e=yield h.a.service.transaction.withdrawProof({burnTxHash:t.burnTxHash,eventSignature:t.eventSign});return e&&e.result?e.result:null}))},statusFromBlockchainForDeposit({},t){return E(this,void 0,void 0,(function*(){return yield h.a.service.transaction.statusFromBlockchainForDeposit(t)}))},statusFromBlockchainForWithdrawal({},t){return E(this,void 0,void 0,(function*(){return yield h.a.service.transaction.statusFromBlockchainForWithdrawal(t)}))},statusFromBlockchainForPlasmaExitPosition({},t){return E(this,void 0,void 0,(function*(){return yield h.a.service.transaction.statusFromBlockchainForPlasmaExitPosition(t)}))},updateApproval({},t){return E(this,void 0,void 0,(function*(){yield h.a.service.transaction.updateApproval(t.txHash,{transactionStatus:t.transactionStatus})}))},updateDeposit({},t){return E(this,void 0,void 0,(function*(){yield h.a.service.transaction.updateDeposit(t.txHash,t.payload)}))},updateActionRequired({},t){return E(this,void 0,void 0,(function*(){yield h.a.service.transaction.updateActionRequired(t.txHash,t.payload)}))},fetchWithdrawalStatus({},t){return E(this,void 0,void 0,(function*(){return yield h.a.service.bridge.withdrawTxStatus(t)}))}}},y={SET_ERC20TOKENS(t,e){t.erc20Tokens=e},SET_TOKEN_BALANCE(t,e){const i=t.erc20Tokens.findIndex(t=>t.id==e.id&&t.isPoS==e.isPoS),s=t.erc20Tokens[i];Object.assign(s,e),h.a.set(t.erc20Tokens,i,s)},SET_SELECTED_TOKEN(t,e){t.selected=e},SET_ALLTOKENS(t,e){t.allTokens=e},SET_DEFAULT_TOKEN(t,e){t.defaultToken=e}},w=i("qatE"),A=i("kB5k"),b=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},P={namespaced:!0,state:{erc20Tokens:[],selected:null,allTokens:[],defaultToken:null},mutations:y,actions:{fetchTokens({state:t,rootState:e,commit:i,dispatch:s,rootGetters:n}){return b(this,void 0,void 0,(function*(){const t=e.widget.appInfo.supportedTokens,a=n["widget/defaultToken"],o=[],r=[];let c=h.a.service.token.erc20TokensRef,d=yield(yield c.orderBy("name").get()).docs,u=h.a.service.token.posERC20TokensRef,l=yield(yield u.orderBy("name").get()).docs;d.forEach(t=>{const e=t.data();e.isPoS=!1,o.push(e)}),l.forEach(t=>{const e=t.data();e.isPoS=!0,r.push(e)});const p=[...o,...r].sort((t,e)=>t.symbol.localeCompare(e.symbol));if(i("SET_ALLTOKENS",p),t){const e=[];p.forEach(i=>{t.forEach(t=>{i.id===t.id&&i.isPoS===t.isPoS&&e.push(i)})}),i("SET_ERC20TOKENS",e)}else i("SET_ERC20TOKENS",p);if(a){const t=p.find(t=>t.id===a.id&&t.isPoS===a.isPoS);i("SET_SELECTED_TOKEN",t),i("SET_DEFAULT_TOKEN",t)}e.account.user&&(yield s("fetchBalances"))}))},fetchBalances({commit:t,dispatch:e,state:i,rootState:s,rootGetters:n}){return b(this,void 0,void 0,(function*(){const t=i.erc20Tokens,s=n["account/address"],a=yield e("getAllBalances",{address:s,tokens:t});a&&(yield e("addTokenUsdValue",a))}))},addTokenUsdValue({state:t,commit:e,rootState:i},s){return b(this,void 0,void 0,(function*(){yield Promise.all(s.map(t=>b(this,void 0,void 0,(function*(){const s=[i.network.main.id.toString(),i.network.matic.id.toString()],n={};let a="";Object.entries(t.addresses).forEach(([e,i])=>{if(s.includes(e.toString())){i.toLowerCase(),t.id;let s={};s=Object(g.h)(t.balance[e],t.decimals),n[e]={value:s,address:i.toLowerCase()},a=t.usdValue}}),t.fullBalance=function(t){return this.balance[t].value},t.balance=n,t.usdValue=a,e("SET_TOKEN_BALANCE",t)}))))}))},getAllBalances({state:t,dispatch:e,rootState:i},s){return b(this,void 0,void 0,(function*(){let t=s.tokens,n=s.address;const a=yield e("fetchAllUsdValues",t),o=[],r=[],c=i.network.matic.chainId,d=h.a.appConfig.maticRPC,u=i.network.main.chainId,l=h.a.appConfig.mainRPC,p=h.a.appConfig.balanceContract,g=h.a.appConfig.ethDBUID,T=h.a.appConfig.maticDBUID;t.forEach(t=>{"MATIC"!==t.symbol&&o.push(t.addresses[c]),"ETH"!==t.symbol&&r.push(t.addresses[u])});const f=Object(w.a)(d,[n],{contractAddress:p}),m=Object(w.a)(l,[n]),v=Object(w.b)(d,n,o,{contractAddress:p}),E=Object(w.b)(l,n,r),[S,y,P,x]=yield Promise.all([f,m,v,E]),C=[];return yield Promise.all(t.map(t=>b(this,void 0,void 0,(function*(){if(t.id===g){const i=y[n],s=new A.BigNumber(i),o=P[t.addresses[c]],r=new A.BigNumber(o),d={[u]:s,[c]:r},h=yield e("getUsdBalance",{token:t,mappedUsdBalances:a});C.push(Object.assign(Object.assign({},t),{balance:d,usdValue:h}))}if(t.id===T){const i=x[t.addresses[u]],s=new A.BigNumber(i),o=S[n],r=new A.BigNumber(o),d={[u]:s,[c]:r},h=yield e("getUsdBalance",{token:t,mappedUsdBalances:a});C.push(Object.assign(Object.assign({},t),{balance:d,usdValue:h}))}if("ETH"!==t.symbol&&"MATIC"!==t.symbol){const i=x[t.addresses[u]],s=new A.BigNumber(i),n=P[t.addresses[c]],o=new A.BigNumber(n),r={[u]:s,[c]:o},d=yield e("getUsdBalance",{token:t,mappedUsdBalances:a});C.push(Object.assign(Object.assign({},t),{balance:r,usdValue:d}))}})))),C}))},fetchAllUsdValues({state:t,dispatch:e},i){return b(this,void 0,void 0,(function*(){const t=i.map(t=>t.symbol.toLowerCase()),s={},n=yield e("getCoingeckoIds");t.forEach(t=>{const e=n.find(e=>e.symbol===t);e&&(s[e.id]=e)});const a=Object.keys(s).join(","),o=["usd"].join(",");try{const t=yield h.a.service.coingecko.getTokenPrice(a,o);Object.entries(t).forEach(([t,e])=>{s[t]=Object.assign(Object.assign({},s[t]),{value:Object.assign({},e)})});const e={};return Object.values(s).forEach(t=>e[t.symbol]=t.value),e}catch(t){console.error("Trouble loading USD balances",t)}}))},getUsdBalance({},{token:t,mappedUsdBalances:e}){return b(this,void 0,void 0,(function*(){if(t.coingeckoId){if("not available"===t.coingeckoId)return 0;try{return yield h.a.service.coingecko.getTokenPrice(t.coingeckoId,"usd")}catch(t){return console.error("Trouble loading USD balances",t),0}}const i=t.symbol.toLowerCase();let s=e&&e[i]&&e[i].usd;return s||0}))},getCoingeckoIds(){return b(this,void 0,void 0,(function*(){try{return yield h.a.service.coingecko.coinsList()}catch(t){console.error("Trouble loading USD balances",t)}}))},calculateGas({dispatch:t},e){return b(this,void 0,void 0,(function*(){switch(e){case"TRANSFER":return t("getGas",{symbol:"MATIC",gas:p.d.TRANSFER});case"MATIC_TRANSFER":return t("getGas",{symbol:"MATIC",gas:p.d.MATIC_TRANSFER});case"POS_WITHDRAW":return t("getGas",{symbol:"MATIC",gas:p.d.POS_WITHDRAW});case"POS_DEPOSIT":return t("getGas",{symbol:"ETH",gas:p.d.POS_DEPOSIT});case"POS_APPROVE":return t("getGas",{symbol:"ETH",gas:p.d.POS_APPROVE});case"POS_EXIT":return t("getGas",{symbol:"ETH",gas:p.d.POS_EXIT});case"PLASMA_TOTAL_EXIT":return t("getGas",{symbol:"ETH",gas:p.d.PLASMA_TOTAL_EXIT});case"APPROVE_SWAP":return t("getGas",{symbol:"MATIC",gas:p.d.APPROVE_SWAP});case"PLASMA_WITHDRAW":return t("getGas",{symbol:"MATIC",gas:p.d.PLASMA_WITHDRAW});case"PLASMA_DEPOSIT":return t("getGas",{symbol:"ETH",gas:p.d.PLASMA_DEPOSIT});case"PLASMA_APPROVE":return t("getGas",{symbol:"ETH",gas:p.d.PLASMA_APPROVE});case"PLASMA_CONFIRM_WITHDRAW":return t("getGas",{symbol:"ETH",gas:p.d.PLASMA_CONFIRM_WITHDRAW});case"PLASMA_PROCESS_EXIT":return t("getGas",{symbol:"ETH",gas:p.d.PLASMA_PROCESS_EXIT});case"CLAIM_REWARDS_VALIDATOR":return t("getGas",{symbol:"ETH",gas:p.d.CLAIM_REWARDS_VALIDATOR});case"CLAIM_REWARDS_DELEGATOR":return t("getGas",{symbol:"ETH",gas:p.d.CLAIM_REWARDS_DELEGATOR});case"APPROVE_DELEGATE":return t("getGas",{symbol:"ETH",gas:p.d.APPROVE_DELEGATE});case"BUY_VOUCHER":return t("getGas",{symbol:"ETH",gas:p.d.BUY_VOUCHER});case"UNBOND_REWARDS_VALIDATOR":return t("getGas",{symbol:"ETH",gas:p.d.UNBOND_REWARDS_VALIDATOR});case"UNBOND_REWARDS_DELEGATOR":return t("getGas",{symbol:"ETH",gas:p.d.UNBOND_REWARDS_DELEGATOR});case"RESTAKE_REWARDS_VALIDATOR":return t("getGas",{symbol:"ETH",gas:p.d.RESTAKE_REWARDS_VALIDATOR});case"RESTAKE_REWARDS_DELEGATOR":return t("getGas",{symbol:"ETH",gas:p.d.RESTAKE_REWARDS_DELEGATOR});case"APPROVE_VALIDATOR":return t("getGas",{symbol:"ETH",gas:p.d.APPROVE_VALIDATOR});case"VALIDATOR_STAKE":return t("getGas",{symbol:"ETH",gas:p.d.VALIDATOR_STAKE});case"CLAIM_STAKE_VALIDATOR":return t("getGas",{symbol:"ETH",gas:p.d.CLAIM_STAKE_VALIDATOR});case"CLAIM_STAKE_DELEGATOR":return t("getGas",{symbol:"ETH",gas:p.d.CLAIM_STAKE_DELEGATOR});case"MOVE_STAKE":return t("getGas",{symbol:"ETH",gas:p.d.MOVE_STAKE});case"ADD_HEIMDALL_FEES":return t("getGas",{symbol:"ETH",gas:p.d.ADD_HEIMDALL_FEES});case"APPROVE_HEIMDALL_FEES":return t("getGas",{symbol:"ETH",gas:p.d.APPROVE_HEIMDALL_FEES})}}))},getGas({getters:t},{symbol:e,gas:i}){return b(this,void 0,void 0,(function*(){const s="ETH"===e?h.a.service.token.getEtherGas():h.a.service.token.getMaticGas(),n=yield s;let a,o=new A.BigNumber(0);"MATIC"===e?(a=new A.BigNumber(n.fast.maxFee),o=new A.BigNumber(n.standard.maxPriorityFee)):(a=new A.BigNumber(n.result.ProposeGasPrice),o=a.minus(new A.BigNumber(n.result.suggestBaseFee)).plus(1));const r=yield t.usdBySymbol(e),c=a.times(i).div(new A.BigNumber(10).pow(9)),d=c.times(r||0);return a=a.times(new A.BigNumber(10).pow(9)),o=o.times(new A.BigNumber(10).pow(9)).dp(0),{gasInToken:c,gasInUsd:d,tokenSymbol:e,gasPrice:a,priorityGasPrice:o}}))}},getters:{active:(t,e)=>t.selected?t.selected:e.default,default:t=>t.erc20Tokens.find(t=>"ETH"===t.symbol.toUpperCase()),bySymbol:t=>e=>t.erc20Tokens.find(t=>null!=e.match(new RegExp(t.symbol,"i"))),byId:t=>e=>t.erc20Tokens.find(t=>e===t.id),usdBySymbol:(t,e)=>t=>{const i=e.bySymbol(t);if(i)return i.usdValue},transferMode:(t,e)=>e.default.isPOS?"POS":"Plasma",amountToUSD:(t,e)=>(t,i)=>{const s=e.usdBySymbol(t)||0;let n=parseFloat(s)*parseFloat(i);return n=isNaN(n)?0:n,n.toFixed(3)}}},x=i("L2JU");h.a.use(x.a);const C=new x.a.Store({state:{locales:["en"],selectedLocale:"en"},modules:{network:u,account:f,widget:v,transaction:S,token:P},actions:{initApp(){h.a.service.initFireBase()}}})},CLrh:function(t,e,i){"use strict";var s=i("Kw5r"),n=i("JZFu");class a{constructor(){this.TIMESTAMP=n.a.firestore.FieldValue.serverTimestamp,this.FieldValue=n.a.firestore.FieldValue}static initFireBase(){if(n.a.apps.length)return;const t=s.a.appConfig;n.a.initializeApp(t.firebase);n.a.firestore().settings({timestampsInSnapshots:!0})}get auth(){return n.a.auth()}get serverTimeStamp(){return this.FieldValue.serverTimestamp()}get activeUser(){return n.a.auth().currentUser}get activeUserId(){const t=this.activeUser;return t&&t.uid}collection(t){return n.a.firestore().collection(t)}get erc20TokensRef(){return this.collection("erc20TokenList")}get activeUserRef(){const t=this.activeUserId;return this.collection("users").doc(t)}get activeUserInfosRef(){const t=this.activeUserId;return this.collection("userInfos").doc(t)}userERC20TokensRef(t){let e=this.activeUserInfosRef.collection("erc20Tokens");return t?e.doc(t):e}get addressBookRef(){return this.activeUserInfosRef.collection("addressBook")}userPendingWithdrawalsRef(t){let e=this.activeUserInfosRef.collection("withdrawals");return t?e.doc(t.toLowerCase()):e}stuckTransactionTxDoc(t){const e=this.collection("stuckTransactions");return t?e.doc(t):e.doc()}deleteStuckTransactionDoc(t){if(t){this.stuckTransactionTxDoc(t).delete()}}setStuckTransactionDoc(t,e){if(t){const i=this.stuckTransactionTxDoc(t);Object.assign(e,{createdAt:this.serverTimeStamp,updatedAt:this.serverTimeStamp}),i.set(e)}}get actionRequiredTxCollection(){return this.activeUserInfosRef.collection("actionRequiredTx")}get depositTxCollection(){return this.activeUserInfosRef.collection("depositTx")}get approvalTxCollection(){return this.activeUserInfosRef.collection("approvalTx")}configs(){return this.collection("config").doc("env").get()}widgetAppsRef(t){return this.collection("widgetApps").where("name","==",t)}widgetAppsImageRef(t){return n.a.storage().ref().child("/widgets/"+t)}get posERC20TokensRef(){return this.collection("posERC20TokenList")}stuckTransactionCollection(){return this.collection("stuckTransactions")}userPoSERC20TokensRef(t){let e=this.activeUserInfosRef.collection("posERC20Tokens");return t?e.doc(t):e}logout(){return n.a.auth().signOut()}signInWithCustomToken(t){return n.a.auth().signInWithCustomToken(t)}}var o=i("0lfv"),r=i("jxKE"),c=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};var d=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};class h{static get coingeckoBaseUrl(){return"https://api.coingecko.com/api/v3"}static get request(){return new o.a({baseUrl:h.coingeckoBaseUrl})}coinsList(){return h.request.get("/coins/list")}getTokenPrice(t,e){let i={ids:t,vs_currencies:e};return h.request.get("/simple/price?",i)}}var u=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};class l extends a{static get bridgeApiBaseUrl(){return s.a.appConfig.bridgeApiBaseUrl}static get request(){return new o.a({baseUrl:l.bridgeApiBaseUrl})}withdrawTxStatus(t){return u(this,void 0,void 0,(function*(){let e;const i=[];return t.forEach(t=>{t.transactionStatus!==r.j.COMPLETE_SUCCESS&&t.transactionStatus!==r.j.ALTERED_EXTERNALLY&&(t.isPoS?i.push({txHash:t.txHash,isPoS:t.isPoS,exitTxHash:t.exitTxHash}):i.push({txHash:t.txHash,isPoS:t.isPoS,relatedTxHash:t.relatedTxHash,exitTxHash:t.exitTxHash}))}),i.length>0&&(e=yield l.request.post("/v2/withdraw",{withdrawTxObjectArray:i})),e||!1}))}updateSuccessAndStuckWithdrawTx(t,e){return u(this,void 0,void 0,(function*(){Object.keys(t).forEach(i=>{const n=e.find(t=>t.txHash===i);t[i].code===r.j.COMPLETE_SUCCESS&&(s.a.service.transaction.updateActionRequired(i,{transactionStatus:r.j.COMPLETE_SUCCESS,status:5}),n&&s.a.service.transaction.deleteStuckTransactionDoc(i)),t[i].code===r.j.COMPLETE_STUCK&&(n||s.a.service.transaction.setStuckTransactionDoc(i,{transactionStatus:r.j.COMPLETE_STUCK,txHash:i}))})}))}approvalTxStatus(t){return u(this,void 0,void 0,(function*(){let e,i=[];if(t){i=t.filter(t=>t.transactionStatus!==r.b.APPROVAL_SUCCESS).map(t=>t.txHash)}return i.length>0&&(e=l.request.post("/v1/approval",{txHashes:i})),e||!1}))}updateSuccessAndFailedApprovalTx(t){return u(this,void 0,void 0,(function*(){Object.keys(t).forEach(e=>{t[e].code===r.b.APPROVAL_SUCCESS?s.a.service.transaction.updateApproval(e,{transactionStatus:r.b.APPROVAL_SUCCESS}):t[e].code===r.b.APPROVAL_FAILED&&s.a.service.transaction.updateApproval(e,{transactionStatus:r.b.APPROVAL_FAILED})})}))}depositTxStatus(t){return u(this,void 0,void 0,(function*(){let e,i=[];if(t){i=t.filter(t=>t.transactionStatus!==r.b.DEPOSIT_COMPLETED&&t.transactionStatus!==r.b.ALTERED_EXTERNALLY&&!t.isConnext).map(t=>t.txHash)}return i.length>0&&(e=l.request.post("/v1/deposit",{txHashes:i})),e||!1}))}updateSuccessAndFailedDepositTx(t){return u(this,void 0,void 0,(function*(){Object.keys(t).forEach(e=>{t[e].code===r.b.DEPOSIT_COMPLETED?s.a.service.transaction.updateDeposit(e,{transactionStatus:r.b.DEPOSIT_COMPLETED}):t[e].code===r.b.DEPOSIT_FAILED?s.a.service.transaction.updateDeposit(e,{transactionStatus:r.b.DEPOSIT_FAILED}):t[e].code===r.b.DEPOSIT_BADHASH?s.a.service.transaction.updateDeposit(e,{transactionStatus:r.b.DEPOSIT_BADHASH}):t[e].code===r.b.DEPOSIT_ENROUTE&&s.a.service.transaction.updateDeposit(e,{transactionStatus:r.b.DEPOSIT_ENROUTE})})}))}}new o.a;const p={firebase:new a,user:new class extends a{login(t){return d(this,void 0,void 0,(function*(){return yield new o.a({baseUrl:s.a.appConfig.walletApiHost}).post("/login/web",t)}))}get authorizedUser(){return new Promise(t=>{this.auth.onAuthStateChanged(e=>{t(e)})})}},transaction:new class extends a{approveTransaction(t){const e=this.approvalTxCollection,i=t.txHash;let s=i?e.doc(i):e.doc();return Object.assign(t,{createdAt:this.serverTimeStamp,updatedAt:this.serverTimeStamp}),s.set(t)}depositTransaction(t){const e=this.depositTxCollection,i=t.txHash;let s=i?e.doc(i):e.doc();return Object.assign(t,{createdAt:this.serverTimeStamp,updatedAt:this.serverTimeStamp}),s.set(t)}getApprovalTxDoc_(t){const e=this.approvalTxCollection;return t?e.doc(t):e.doc()}getDepositTxDoc_(t){const e=this.depositTxCollection;return t?e.doc(t):e.doc()}getActionRequiredTxDoc_(t){const e=this.actionRequiredTxCollection;return t?e.doc(t):e.doc()}updateActionRequired(t,e){const i=this.getActionRequiredTxDoc_(t);return Object.assign(e,{updatedAt:this.serverTimeStamp}),r.i.$emit("updateWithdrawTxStatus",{txHash:t,payload:e}),i.update(e)}setActionRequired(t){const e=this.getActionRequiredTxDoc_(t.txHash);return Object.assign(t,{createdAt:this.serverTimeStamp,updatedAt:this.serverTimeStamp}),e.set(t)}exitTransaction(t){return new o.a({baseUrl:s.a.appConfig.relatedTxApi}).get("/api/v1/exit",t)}updateApproval(t,e){const i=this.getApprovalTxDoc_(t);return Object.assign(e,{updatedAt:this.serverTimeStamp}),r.i.$emit("updateTxStatus",{txHash:t,payload:e}),i.update(e)}updateDeposit(t,e){const i=this.getDepositTxDoc_(t);return Object.assign(e,{updatedAt:this.serverTimeStamp}),r.i.$emit("updateTxStatus",{txHash:t,payload:e}),i.update(e)}getDepositTxDoc(t){return this.getDepositTxDoc_(t)}getActionRequiredTxDoc(t){return this.getActionRequiredTxDoc_(t)}withdrawProof(t){return new o.a({baseUrl:s.a.appConfig.networkApiHost}).get(`/exit-payload/${t.burnTxHash}?eventSignature=${t.eventSignature}`)}fetchApprovals(){return c(this,void 0,void 0,(function*(){const t=[];return(yield(yield this.approvalTxCollection.orderBy("updatedAt").get()).docs).forEach(e=>{const i=e.data();t.push(i)}),t}))}fetchDeposits(){return c(this,void 0,void 0,(function*(){const t=[];return(yield(yield this.depositTxCollection.orderBy("updatedAt").get()).docs).forEach(e=>{const i=e.data();t.push(i)}),t}))}fetchWithdrawals(){return c(this,void 0,void 0,(function*(){const t=[];return(yield(yield this.actionRequiredTxCollection.orderBy("updatedAt").get()).docs).forEach(e=>{const i=e.data();t.push(i)}),t}))}fetchStuckTransactions(){return c(this,void 0,void 0,(function*(){return[]}))}statusFromBlockchainForDeposit(t){return new o.a({baseUrl:s.a.appConfig.relatedTxApi}).get("/api/v1/deposit?",t)}statusFromBlockchainForWithdrawal(t){return new o.a({baseUrl:s.a.appConfig.relatedTxApi}).get("/api/v1/exit?",t)}statusFromBlockchainForPlasmaExitPosition(t){return new o.a({baseUrl:s.a.appConfig.relatedTxApi}).get("/api/v1/plasma-exit/position?",t)}},token:new class extends a{get erc20TokensRef(){return this.collection("erc20TokenList")}get posERC20TokensRef(){return this.collection("posERC20TokenList")}getEtherGas(){return new o.a(s.a.appConfig.ethGasStation).get()}getMaticGas(){return new o.a(s.a.appConfig.gasStation).get()}},coingecko:new h,bridge:new l,initFireBase(){a.initFireBase()}};s.a.service=p},UMHx:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return h}));var s=i("wVYR"),n=i.n(s),a=i("xI+a"),o=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};const r=["eth_signTransaction","eth_sendTransaction","eth_sign","eth_signTypedDataLegacy","eth_signTypedData","personal_sign"],c=["eth_accounts",...r];if("undefined"==typeof window||!window.XMLHttpRequest)throw new Error("XMLHttpRequest not found");function d(t,e){return function(i,s){const n={result:null};["id","jsonrpc"].forEach(e=>{n[e]=t[e]}),n.result=s,e(i,n)}}window.XMLHttpRequest=window.XMLHttpRequest;class h{constructor(t){this.timeout=0,this.bridgeURL="https://bridge.walletconnect.org",this.showQRCode=!0,this.callbacks={},t.showQRCode=null==t.showQRCode?this.showQRCode:t.showQRCode,Object.assign(this,t)}prepareRequest(e=!0){const i=new window.XMLHttpRequest;if(i.open("POST",this.host,e),this.user&&this.password){const e=t.from(this.user+":"+this.password).toString("base64");i.setRequestHeader("Authorization","Basic "+e)}return i.setRequestHeader("Content-Type","application/json"),this.headers&&this.headers.forEach(t=>{i.setRequestHeader(t.name,t.value)}),i}send(t={}){const e=this.prepareRequest(!1);try{e.send(JSON.stringify(t))}catch(t){throw new Error("Invalid connection "+this.host)}let i=e.responseText;try{i=JSON.parse(i)}catch(t){throw new Error("Invalid response "+e.responseText)}return i}createWebconnector(){return o(this,void 0,void 0,(function*(){if(this.webconnector=new n.a({bridge:this.bridgeURL}),!this.webconnector.connected){const t=new Promise((t,e)=>{this.webconnector.on("connect",(i,s)=>{if(i)return e(i);this.callbacks.onConnect&&this.callbacks.onConnect(i,s),this.showQRCode;const{accounts:n}=s.params[0];t(n)}),this.webconnector.on("disconnect",(t,e)=>{if(t)throw t;this.callbacks.onDisconnect&&this.callbacks.onDisconnect(t,e),this.showQRCode})});return this.webconnector.createSession().then(()=>{const t=this.webconnector.uri;this.callbacks.onCreate&&this.callbacks.onCreate(t),this.showQRCode}).then(()=>t)}return new Promise((t,e)=>{const i=this.webconnector&&this.webconnector.session&&this.webconnector.session.accounts;i&&i.length?t(i):this.webconnector.on("session_update",(i,s)=>{if(i)return e(i);this.callbacks.onUpdate&&this.callbacks.onUpdate(i,s);const{accounts:n}=s.params[0];t(n)})})}))}_sendAsync(t,e){const i=this.prepareRequest(!0);i.onreadystatechange=()=>{if(4===i.readyState&&1!==i.timeout){let t,s=i.responseText;try{s=JSON.parse(s)}catch(e){t=new Error("Invalid response "+i.responseText)}e(t,s)}},i.ontimeout=()=>{e(new Error("Connection timeout "+this.timeout))};try{i.send(JSON.stringify(t))}catch(t){e(new Error("Invalid connection "+this.host))}}sendAsync(t,e){let i=Promise.resolve();if(!c.includes(t.method))return i.then(()=>{this._sendAsync(t,e)}).catch(t=>{e(new Error("Invalid connection "+t))});if(i=this.createWebconnector(),r.includes(t.method)){const s=d(t,e);return"eth_sendTransaction"===t.method&&t.params.push(Object(a.convertNumberToHex)(t.params[0].chainId||this.chainId)),i.then(()=>this.webconnector.sendCustomRequest(t)).then(t=>{s(null,t)}).catch(t=>{s(t,null)})}if("eth_accounts"===t.method)return i.then(()=>{let i;this.webconnector&&this.webconnector.session&&(i=this.webconnector.session.accounts),d(t,e)(null,i||[])}).catch(d(t,e))}isConnected(){return!(!this.webconnector||!this.webconnector.connected)}disconnect(){this.webconnector&&this.webconnector.connected&&this.webconnector.killSession()}}}).call(this,i("tjlA").Buffer)},avKp:function(t,e,i){"use strict";var s=i("jxKE"),n=i("meUc"),a=i.n(n),o=i("kB5k"),r=i("7J+i"),c=i("0lfv"),d=i("L+H0"),h=i("gnxY"),u=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},l=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};const p=new o.BigNumber(10),g=new o.BigNumber(0);let T=class extends r.a{get isPoSTransaction(){return this.selectedToken.isPoS}validate(){return l(this,void 0,void 0,(function*(){if(!s.e)return"Metamask is not enabled";const t=new a.a(s.c);return(yield t.eth.getChainId())!==this.mainNetwork.chainId?`Please select the ${this.mainNetwork.name} Network in Metamask`:this.isEmpty(this.inputAmount)?this.$t("invalid.amount"):this.selectedToken.balance[this.mainNetwork.chainId].value.gte(parseFloat(this.inputAmount))?void 0:this.$t("invalid.balance")}))}reloadTransactions(){return l(this,void 0,void 0,(function*(){this.$store.dispatch("token/fetchBalances"),yield this.$store.dispatch("transaction/fetchApprovals"),yield this.$store.dispatch("transaction/fetchDeposits")}))}saveApprovalData(t,e,i){return l(this,void 0,void 0,(function*(){const n=this.$store.state.widget.appInfo;yield this.$store.dispatch("transaction/approveTransaction",{actionNeeded:!0,txHash:t,wappId:n.id,amount:e,isPoS:i,chainId:this.networks.main.chainId,tokenId:this.selectedToken.id,transactionStatus:s.b.APPROVAL_PENDING})}))}approvePOSTransaction(){return l(this,void 0,void 0,(function*(){const t=this.selectedToken.addresses[this.mainNetwork.chainId],e=new o.BigNumber(this.inputAmount).times(p.pow(new o.BigNumber(this.selectedToken.decimals))),i=yield this.posClient;if(new o.BigNumber(yield i.getERC20Allowance(this.user.address,t,{from:this.user.address})).gte(e))this.reloadTransactions(),this.transactionStatus=s.b.APPROVAL_SUCCESS,this.isApprovalLoading=!1;else{const e=(yield this.calculateGas("POS_APPROVE")).priorityGasPrice;yield i.approveMaxERC20ForDeposit(t,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:t=>l(this,void 0,void 0,(function*(){yield this.saveApprovalData(t,this.inputAmount,!0),this.approvedTransactionHash=t,this.transactionStatus=s.b.APPROVAL_PENDING,Object(c.f)(h.a.approveComplete,{}),yield this.reloadTransactions(),this.isApprovalLoading=!1})),onError:t=>l(this,void 0,void 0,(function*(){this.$logger.error(t),this.isApprovalLoading=!1,this.transactionStatus=s.b.APPROVAL_FAILED,this.error=c.c.getErrMessage(t),Object(c.f)(h.a.approveError,this.error)}))})}}))}approvePlasmaTransaction(){return l(this,void 0,void 0,(function*(){const t=this.selectedToken.addresses[this.mainNetwork.chainId],e=new o.BigNumber(this.inputAmount).times(p.pow(new o.BigNumber(this.selectedToken.decimals))),i=yield this.plasmaClient;yield i.initialize();if(new o.BigNumber(yield i.getERC20Allowance(this.user.address,t,{from:this.user.address})).gte(e))this.reloadTransactions(),this.transactionStatus=s.b.APPROVAL_SUCCESS,this.isApprovalLoading=!1;else{const e=(yield this.calculateGas("PLASMA_APPROVE")).priorityGasPrice;yield i.approveMaxERC20TokensForDeposit(t,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:t=>l(this,void 0,void 0,(function*(){yield this.saveApprovalData(t,this.inputAmount,!1),this.approvedTransactionHash=t,this.transactionStatus=s.b.APPROVAL_PENDING,Object(c.f)(h.a.approveComplete,{}),yield this.reloadTransactions()})),onError:t=>l(this,void 0,void 0,(function*(){this.$logger.error(t),this.transactionStatus=s.b.APPROVAL_FAILED,this.error=c.c.getErrMessage(t),this.isApprovalLoading=!1,Object(c.f)(h.a.approveError,this.error)}))})}this.isApprovalLoading=!1}))}initApprove(){return l(this,void 0,void 0,(function*(){this.isApprovalLoading=!0;try{if(this.error=yield this.validate(),this.error)return void(this.isApprovalLoading=!1);this.isPoSTransaction?yield this.approvePOSTransaction():yield this.approvePlasmaTransaction()}catch(t){this.error=c.c.getErrMessage(t),this.$logger.error(t),this.isApprovalLoading=!1,Object(c.f)(h.a.approveError,this.error)}}))}checkForApproval(t){return l(this,void 0,void 0,(function*(){let e=g,i=g;const n=this.selectedToken.addresses[this.mainNetwork.chainId],a=new o.BigNumber(this.inputAmount).times(p.pow(new o.BigNumber(this.selectedToken.decimals)));if(this.isPoSTransaction){const t=yield this.posClient;i=yield t.getERC20Allowance(this.user.address,n,{from:this.user.address})}else{const t=yield this.plasmaClient;yield t.initialize(),i=yield t.getERC20Allowance(this.user.address,n,{from:this.user.address})}e=new o.BigNumber(i),e.gte(a)&&(this.transactionStatus=s.b.APPROVAL_SUCCESS,yield this.$store.dispatch("transaction/updateApproval",{txHash:t,transactionStatus:s.b.APPROVAL_SUCCESS}),this.allowanceFromBlockchain=!0)}))}};T=u([d.b],T);var f=T,m=i("Kw5r"),v=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},E=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};const S=new o.BigNumber(10);let y=class extends m.a{handleAddTokenToMetamask(t){return E(this,void 0,void 0,(function*(){try{yield Object(c.d)(this.maticNetwork),yield s.c.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:t.addresses[this.maticNetwork.chainId],symbol:t.symbol.substr(0,6),decimals:t.decimals,image:t.logo}}})}catch(t){this.$logger.error("Failed to add the token to metamask"),this.error=c.c.getErrMessage(t)}}))}get inputAmountWithDecimal(){const t=new o.BigNumber(this.inputAmount),e=new o.BigNumber(this.selectedToken.decimals);return t.times(S.pow(e)).toString(10)}get isEtherToken(){const t=this.selectedToken;return t&&"ETH"===t.symbol}saveDepositData(t,e,i){return E(this,void 0,void 0,(function*(){const n=this.$store.state.widget.appInfo;yield this.$store.dispatch("transaction/depositTransaction",{actionNeeded:!0,txHash:t,wappId:n.id,amount:e,isPoS:i,chainId:this.networks.main.chainId,tokenId:this.selectedToken.id,transactionStatus:s.b.DEPOSIT_PENDING})}))}depositPOSTransaction(t){return E(this,void 0,void 0,(function*(){const e=this.selectedToken.addresses[this.mainNetwork.chainId],i=new o.BigNumber(this.inputAmount).times(S.pow(new o.BigNumber(this.selectedToken.decimals))),n=yield this.posClient;let a=!1;if(this.isEtherToken)a=!0;else{new o.BigNumber(yield n.getERC20Allowance(this.user.address,e,{from:this.user.address})).gte(i)&&(a=!0)}if(a){const e=(yield this.calculateGas("POS_DEPOSIT")).priorityGasPrice;if(this.isEtherToken)yield n.depositEtherForUser(this.user.address,this.inputAmountWithDecimal,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:e=>E(this,void 0,void 0,(function*(){yield this.saveDepositData(e,this.inputAmount,!0),this.takesTooLong&&(yield this.tryAgain(t)),this.depositTransactionHash=e,this.transactionStatus=s.b.DEPOSIT_PENDING,Object(c.f)(h.a.depositComplete,{}),yield this.reloadTransactions(),this.isLoading=!1})),onError:t=>E(this,void 0,void 0,(function*(){this.$logger.error(t),this.transactionStatus=s.b.DEPOSIT_FAILED,this.error=c.c.getErrMessage(t),this.isLoading=!1,Object(c.f)(h.a.depositError,this.error)}))});else{const i=this.selectedToken.addresses[this.mainNetwork.chainId];yield n.depositERC20ForUser(i,this.user.address,this.inputAmountWithDecimal,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:e=>E(this,void 0,void 0,(function*(){yield this.saveDepositData(e,this.inputAmount,!0),this.takesTooLong&&(yield this.tryAgain(t)),this.depositTransactionHash=e,this.transactionStatus=s.b.DEPOSIT_PENDING,Object(c.f)(h.a.depositComplete,{}),yield this.reloadTransactions()})),onError:t=>E(this,void 0,void 0,(function*(){this.$logger.error(t),this.transactionStatus=s.b.DEPOSIT_FAILED,this.error=c.c.getErrMessage(t),this.isLoading=!1,Object(c.f)(h.a.depositError,this.error)}))})}}else this.isLoading=!1}))}depositPlasmaTransaction(t){return E(this,void 0,void 0,(function*(){const e=this.selectedToken.addresses[this.mainNetwork.chainId],i=new o.BigNumber(this.inputAmount).times(S.pow(new o.BigNumber(this.selectedToken.decimals))),n=yield this.plasmaClient;yield n.initialize();let a=!1;if(this.isEtherToken)a=!0;else{new o.BigNumber(yield n.getERC20Allowance(this.user.address,e,{from:this.user.address})).gte(i)&&(a=!0)}if(a){const e=(yield this.calculateGas("PLASMA_DEPOSIT")).priorityGasPrice;if(this.isEtherToken)yield n.depositEther(this.inputAmountWithDecimal,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:e=>E(this,void 0,void 0,(function*(){yield this.saveDepositData(e,this.inputAmount,!1),this.depositTransactionHash=e,this.$logger.debug("TX HASH",this.depositTransactionHash),this.transactionStatus=s.b.DEPOSIT_PENDING,this.takesTooLong&&(yield this.tryAgain(t)),Object(c.f)(h.a.depositComplete,{}),yield this.reloadTransactions(),this.isLoading=!1})),onError:t=>E(this,void 0,void 0,(function*(){this.$logger.error(t),this.transactionStatus=s.b.DEPOSIT_FAILED,this.error=c.c.getErrMessage(t),this.isLoading=!1,Object(c.f)(h.a.depositError,this.error)}))});else{const i=this.selectedToken.addresses[this.mainNetwork.chainId];yield n.depositERC20ForUser(i,this.user.address,this.inputAmountWithDecimal,{from:this.user.address,maxPriorityFeePerGas:e,onTransactionHash:e=>E(this,void 0,void 0,(function*(){yield this.saveDepositData(e,this.inputAmount,!1),this.takesTooLong&&(yield this.tryAgain(t)),this.depositTransactionHash=e,this.transactionStatus=s.b.DEPOSIT_PENDING,Object(c.f)(h.a.depositComplete,{}),yield this.reloadTransactions()})),onError:t=>E(this,void 0,void 0,(function*(){this.$logger.error(t),this.transactionStatus=s.b.DEPOSIT_FAILED,this.error=c.c.getErrMessage(t),this.isLoading=!1,Object(c.f)(h.a.depositError,this.error)}))})}}else this.isLoading=!1}))}initDeposit(t){return E(this,void 0,void 0,(function*(){this.isLoading=!0;try{if(this.error=yield this.validate(),this.error)return void(this.isLoading=!1);this.isPoSTransaction?yield this.depositPOSTransaction(t):yield this.depositPlasmaTransaction(t)}catch(t){this.error=c.c.getErrMessage(t),this.$logger.error(t),this.isLoading=!1,Object(c.f)(h.a.depositError,this.error)}}))}checkForDeposit(t){return E(this,void 0,void 0,(function*(){let e=null;const i=this.deposits.find(e=>e.txHash===t);if(i&&i.createdAt.seconds>1620424800&&(e=yield this.$store.dispatch("transaction/statusFromBlockchainForDeposit",{transactionHash:t,userAddress:this.user.address.toLowerCase(),amount:this.inputAmount,isEther:this.isEtherToken,rootToken:this.selectedToken.addresses[this.mainNetwork.chainId].toLowerCase()})),1===e.status&&e.initialTransactionHash!==e.newTransactionHash)this.transactionStatus=s.b.DEPOSIT_COMPLETED,yield this.$store.dispatch("transaction/updateDeposit",{txHash:t,payload:{transactionStatus:s.b.DEPOSIT_COMPLETED,newTransactionHash:e.newTransactionHash}}),this.depositFromBlockchain=!0;else{const e=m.a.service.transaction.getDepositTxDoc(t);yield e.update({tempTimestamp:m.a.service.transaction.serverTimeStamp});const i=yield e.get();i.get("tempTimestamp").seconds>i.get("updatedAt").seconds+s.h&&(this.takesTooLong=!0)}}))}tryAgain(t){return E(this,void 0,void 0,(function*(){yield this.$store.dispatch("transaction/updateDeposit",{txHash:t,payload:{transactionStatus:s.b.ALTERED_EXTERNALLY}}),this.takesTooLong=!1}))}cancelDepositTryAgain(t){return E(this,void 0,void 0,(function*(){this.isCancelButtonLoading=!0,yield this.$store.dispatch("transaction/updateDeposit",{txHash:t,payload:{transactionStatus:s.b.ALTERED_EXTERNALLY}}),this.isCancelButtonLoading=!1}))}};y=v([d.b],y);var w=y,A=function(t,e,i,s){var n,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(o=(a<3?n(o):a>3?n(e,i,o):n(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},b=function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))};const P=new o.BigNumber(10);let x=class extends r.a{get isEtherToken(){const t=this.selectedToken;return t&&"ETH"===t.symbol}get isPoSToken(){return this.selectedToken.isPoS}checkAllowance(){return b(this,void 0,void 0,(function*(){try{const t=this.selectedToken.addresses[this.mainNetwork.chainId],e=new o.BigNumber(this.inputAmount).times(P.pow(new o.BigNumber(this.selectedToken.decimals)));if(this.isEtherToken)this.allowance=!0;else if(this.isPoSToken){const i=yield this.posClient;new o.BigNumber(yield i.getERC20Allowance(this.user.address,t,{from:this.user.address})).gte(e)?this.allowance=!0:this.allowance=!1}else{const i=yield this.plasmaClient;yield i.initialize();new o.BigNumber(yield i.getERC20Allowance(this.user.address,t,{from:this.user.address})).gte(e)?this.allowance=!0:this.allowance=!1}}catch(t){this.$logger.debug("error: ",t),this.error=t.message.substring(0,60)}}))}};x=A([d.b],x);var C=x;e.a=[f,w,C]},ggXD:function(t,e,i){"use strict";var s=i("Kw5r"),n=i("lLqN"),a=i.n(n);let o=!1;const r={initTrack(t){const e="mainnet"===s.a.appConfig.matic.network;e&&a.a.init(s.a.appConfig.MIXPANEL_TOKEN),t&&e?a.a.identify(t.address):t={},o=!0},stopTrack(){o=!1},track(t,e={}){if(o)try{a.a.track(t,JSON.parse(JSON.stringify(e)))}catch(t){console.error("unable to send to mixpanel",t)}},error(t){const e={capture:!1};return setTimeout(()=>{0},100),e},debug(...t){0}};var c={install(){s.a.$logger=r,s.a.mixin({beforeCreate(){this.$logger=r}})}},d=i("YjGw"),h=i.n(d);const u={};for(const t in h.a)u[h.a[t].symbol]=t;var l={install(){s.a.prototype.isEmpty=function(t){return null==t||0===t.length},s.a.prototype.tokenImage=function(t){const e=u[t];if(e)return this.$options.filters.imgPath("tokens/"+h.a[e].icon)}}},p=i("qSUR");s.a.use(c),s.a.use(l),s.a.use(p.a)},r7w9:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var s=i("jE9Z"),n=i("CO9F"),a=i("AZYn"),o=i("GVSY"),r=i("qFEw"),c=i("Dt2H"),d=i("1ZOr");const h=[{path:"/",name:"home",component:n.a,children:[{path:"/deposit",name:"deposit",component:r.a},{path:"/withdraw",name:"withdraw",component:c.a}]},{path:"/send",name:"send",component:a.a},{path:"/login",name:"login",component:o.a},{path:"/notification",name:"notification",component:d.a}];i("Kw5r").a.use(s.a);const u=new s.a({mode:"abstract",routes:h,scrollBehavior:(t,e)=>({x:0,y:0})}),l=s.a.prototype.push;s.a.prototype.push=function(t){return new Promise((e,i)=>{l.call(this,t,()=>{e(this.currentRoute)},t=>{"NavigationDuplicated"===t.name?e(this.currentRoute):i(t)})})}}}]);