(window.wpJsonpMaticWidget=window.wpJsonpMaticWidget||[]).push([[9],{"/0By":function(e,r,t){"use strict";var a=t("TqRt"),n=a(t("o0o1")),o=a(t("yXPU")),s=a(t("lwsE")),i=a(t("W8MJ")),c=t("EJgX"),d=c.daiAbi,u=c.erc20Eip2612Abi,p=t("5h+m").ethers,f=t("7U23").config,l={name:f.daiDomainName,version:f.daiVersion};function h(e){f&&f.logsEnabled&&console.log&&console.log(e)}var m=function(){function e(r,t,a){(0,s.default)(this,e),!function(e){return p.providers.Provider.isProvider(e)}(r)?this.provider=new p.providers.Web3Provider(r):this.provider=r,this.erc20ForwarderAddress=t,this.daiTokenAddress=a,this.daiDomainData=l}var r,t;return(0,i.default)(e,[{key:"daiPermit",value:(t=(0,o.default)(n.default.mark((function e(r){var t,a,o,s,i,c,u,m,g,w,v,b,y,k;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=r.spender||this.erc20ForwarderAddress,a=r.expiry||Math.floor(Date.now()/1e3+3600),o=r.allowed||!0,e.t0=r.userAddress,e.t0){e.next=9;break}return e.next=8,this.provider.getSigner().getAddress();case 8:e.t0=e.sent;case 9:return s=e.t0,e.next=12,this.provider.getNetwork();case 12:return i=e.sent,l.chainId=i.chainId,l.verifyingContract=this.daiTokenAddress,c=new p.Contract(this.daiDomainData.verifyingContract,d,this.provider.getSigner()),e.next=18,c.nonces(s);case 18:return u=e.sent,m={types:{EIP712Domain:f.domainType,Permit:f.daiPermitType},domain:this.daiDomainData,primaryType:"Permit",message:{holder:s,spender:t,nonce:parseInt(u),expiry:parseInt(a),allowed:!0}},e.next=22,this.provider.send("eth_signTypedData_v4",[s,JSON.stringify(m)]);case 22:return g=e.sent,h("success"),w=g.substring(2),v="0x"+w.substring(0,64),b="0x"+w.substring(64,128),y=parseInt(w.substring(128,130),16),e.next=30,c.permit(s,t,parseInt(u),parseInt(a.toString()),o,y,v,b);case 30:return k=e.sent,e.abrupt("return",k);case 34:throw e.prev=34,e.t1=e.catch(0),h(e.t1),e.t1;case 38:case"end":return e.stop()}}),e,this,[[0,34]])}))),function(e){return t.apply(this,arguments)})},{key:"eip2612Permit",value:(r=(0,o.default)(n.default.mark((function e(r){var t,a,o,s,i,c,d,l,m,g,w,v,b,y;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=r.domainData,a=r.spender||this.erc20ForwarderAddress,o=r.value,s=r.deadline||Math.floor(Date.now()/1e3+3600),e.t0=r.userAddress,e.t0){e.next=10;break}return e.next=9,this.provider.getSigner().getAddress();case 9:e.t0=e.sent;case 10:return i=e.t0,c=new p.Contract(t.verifyingContract,u,this.provider.getSigner()),e.next=14,c.nonces(i);case 14:return d=e.sent,l={types:{EIP712Domain:f.domainType,Permit:f.eip2612PermitType},domain:t,primaryType:"Permit",message:{owner:i,spender:a,nonce:parseInt(d),value:o,deadline:parseInt(s)}},e.next=18,this.provider.send("eth_signTypedData_v4",[i,JSON.stringify(l)]);case 18:return m=e.sent,h("success"),g=m.substring(2),w="0x"+g.substring(0,64),v="0x"+g.substring(64,128),b=parseInt(g.substring(128,130),16),e.next=26,c.permit(i,a,o,parseInt(s.toString()),b,w,v);case 26:return y=e.sent,e.abrupt("return",y);case 30:throw e.prev=30,e.t1=e.catch(0),h(e.t1),e.t1;case 34:case"end":return e.stop()}}),e,this,[[0,30]])}))),function(e){return r.apply(this,arguments)})}]),e}();e.exports=m},"Lu/O":function(e,r,t){"use strict";var a,n,o,s,i,c,d,u=t("TqRt"),p=u(t("cDf5")),f=u(t("o0o1")),l=u(t("yXPU")),h=t("Ec79"),m=t("5h+m"),g=t("JM5R"),w=t("ga3E"),v=t("+VWO").toJSONRPCPayload,b=t("7U23"),y=b.config,k=b.RESPONSE_CODES,x=b.EVENTS,A=b.BICONOMY_RESPONSE_CODES,E=b.STATUS,P=y.baseURL,I=y.JSON_RPC_VERSION,O=y.nativeMetaTxUrl,R=t("/0By"),N=t("svOm"),S=t("1hVF"),T=S.buildForwardTxRequest,C=S.getDomainSeperator,D=t("EJgX"),_=D.erc20ForwarderAbi,M=D.oracleAggregatorAbi,B=D.feeManagerAbi,F=D.biconomyForwarderAbi,L=D.transferHandlerAbi,G=t("oY9k"),Y={},W={},U={},j=new(t("+qE3").EventEmitter),q={name:y.eip712DomainName,version:y.eip712SigVersion,verifyingContract:y.eip712VerifyingContract},H={name:y.daiDomainName,version:y.daiVersion};function J(e,r){if(function(e){if(!e)throw new Error("Options object needs to be passed to Biconomy Object with apiKey as mandatory key");if(!e.apiKey)throw new Error("apiKey is required in options object when creating Biconomy object")}(r),this.isBiconomy=!0,this.status=E.INIT,this.options=r,this.apiKey=r.apiKey,this.isLogin=!1,this.dappAPIMap={},this.strictMode=r.strictMode||!1,this.providerId=r.providerId||0,this.readViaContract=r.readViaContract||!1,this.READY=E.BICONOMY_READY,this.LOGIN_CONFIRMATION=x.LOGIN_CONFIRMATION,this.ERROR=x.BICONOMY_ERROR,this.pendingLoginTransactions={},this.jsonRPC={messageId:0},this.originalProvider=e,this.isEthersProviderPresent=!1,this.canSignMessages=!1,r.debug&&(y.logsEnabled=!0),r.walletProvider){if(ce(r.walletProvider))throw new Error("Wallet Provider in options can't be an ethers provider. Please pass the provider you get from your wallet directly.");this.walletProvider=new m.providers.Web3Provider(r.walletProvider)}if(!e)throw new Error("Please pass a provider to Biconomy.");ce(e)?(this.ethersProvider=e,this.isEthersProviderPresent=!0):this.ethersProvider=new m.providers.Web3Provider(e),function(e,r){ie.apply(this,arguments)}(this.apiKey,this);for(var t=Object.getPrototypeOf(e),a=Object.getOwnPropertyNames(t),n=0;n<a.length;n++)this[a[n]]=e[a[n]];for(var o in e)this[o]||(this[o]=e[o]);var s=this;this.send=function(e,r){var t=this;return"string"==typeof e&&(e={id:1,jsonrpc:"2.0",method:e,params:r}),"eth_sendTransaction"==e.method?new h((function(a,n){X(t,e,(function(o,i){var c=t._createJsonRpcResponse(e,o,i);r&&!s.isEthersProviderPresent&&r(o,c),c.error?n(c.error):a(c.result)}))})):"eth_sendRawTransaction"==e.method?new h((function(a,n){K(t,e,(function(o,i){var c=t._createJsonRpcResponse(e,o,i);r&&!s.isEthersProviderPresent&&r(o,c),c.error?n(c.error):a(c.result)}))})):s.isEthersProviderPresent?s.originalProvider.send(e.method,e.params):void s.originalProvider.send(e,r)},this.request=function(e,r){var t={method:e.method,params:e.params};return"eth_sendTransaction"==t.method?new h((function(e,a){X(s,t,(function(t,n){if(t)return a(t);n.result?(e(n.result),me(n.result)):(e(n),me(n)),r&&r(t,n)}))})):"eth_sendRawTransaction"==t.method?new h((function(e,a){K(s,t,(function(t,n){if(t)return a(t);n.result?(e(n.result),me(n.result)):(e(n),me(n)),r&&r(t,n)}))})):s.originalProvider.request?s.originalProvider.request(e,r):s.originalProvider.send?new h(function(){var e=(0,l.default)(f.default.mark((function e(r,a){var n,o;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v(s,t.method,t.params),!s.isEthersProviderPresent){e.next=14;break}return e.prev=2,e.next=5,s.originalProvider.send(n.method,n.params);case 5:o=e.sent,r(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),a(e.t0);case 12:e.next=15;break;case 14:s.originalProvider.send(n,(function(e,t){if(e)return a(e);t.result?r(t.result):r(t)}));case 15:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(r,t){return e.apply(this,arguments)}}()):h.reject("Invalid provider object passed to Biconomy as it doesn't support request or send method")},this.sendAsync=this.send}function V(e,r){if(e&&r&&Y[e])return Y[e].decodeMethod(r)}function K(e,r,t){return z.apply(this,arguments)}function z(){return(z=(0,l.default)(f.default.mark((function e(r,t,a){var n,o,s,i,c,u,l,h,w,v,b,A,E,P,I,R,N,S,T,D,_,M,B,F,L,G,Y,q,H,J,K,z,X,$,Q;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.params[0]){e.next=98;break}if("string"==typeof(n=t.params[0])?o=n:"object"==(0,p.default)(n)&&(s=n.signature,o=n.rawTransaction,c=n.signatureType,i=n.forwardRequest),!o){e.next=93;break}if(!((u=g.decodeTx(o)).to&&u.data&&u.value)){e.next=88;break}if(l=u.to.toLowerCase(),h=V(l,u.data)){e.next=19;break}if(h=V(y.SCW,u.data)){e.next=19;break}if(!r.strictMode){e.next=16;break}return w=he(k.DASHBOARD_DATA_MISMATCH,"No smart contract wallet or smart contract registered on dashboard with address (".concat(u.to,")")),e.abrupt("return",a(w));case 16:return me("Strict mode is off so falling back to default provider for handling transaction"),"object"==(0,p.default)(n)&&n.rawTransaction&&(t.params=[n.rawTransaction]),e.abrupt("return",Z(r,t,a,"No smart contract wallet or smart contract registered on dashboard with address (".concat(u.to,")")));case 19:if(v=h.name,(b=r.dappAPIMap[l]?r.dappAPIMap[l][v]:void 0)?(E=b.contractAddress.toLowerCase(),A=U[E]):(b=r.dappAPIMap[y.SCW]?r.dappAPIMap[y.SCW][v]:void 0,A=U[y.SCW]),b){e.next=33;break}if(me("API not found for method ".concat(v)),me("Strict mode ".concat(r.strictMode)),!r.strictMode){e.next=30;break}return P=he(k.API_NOT_FOUND,"Biconomy strict mode is on. No registered API found for method ".concat(v,". Please register API from developer dashboard.")),e.abrupt("return",a(P,null));case 30:return me("Falling back to default provider as strict mode is false in biconomy"),"object"==(0,p.default)(n)&&n.rawTransaction&&(t.params=[n.rawTransaction]),e.abrupt("return",Z(r,t,a,"Current provider can not sign transactions. Make sure to register method ".concat(v," on Biconomy Dashboard")));case 33:if(me("API found"),I=h.params,R=[],N=m.utils.parseTransaction(o),S=N?N.from:void 0,me("signer is ".concat(S)),S){e.next=42;break}return T=he(k.ERROR_RESPONSE,"Not able to get user account from signed transaction"),e.abrupt("return",a(T));case 42:if(D=u.gasLimit,b.url!=O){e.next=85;break}if(A==r.DEFAULT){e.next=74;break}for(u.data,_=[],M=0;M<I.length;M++)_.push(ne(I[M]));if(D&&0!=parseInt(D)){e.next=59;break}if(!(B=W[l])){e.next=57;break}return L=new m.Contract(l,JSON.parse(B),r.ethersProvider),e.next=54,(F=L.estimateGas)[v].apply(F,_.concat([{from:S}]));case 54:D=e.sent,me("gas limit number"+m.BigNumber.from(D.toString()).add(m.BigNumber.from(5e3)).toNumber());case 57:e.next=60;break;case 59:m.BigNumber.from(D.toString()).toNumber();case 60:return me(i),R.push(i),c&&c==r.EIP712_SIGN&&(me(G=C(d)),R.push(G)),R.push(s),(Y={}).from=S,Y.apiId=b.id,Y.params=R,Y.to=l,c&&c==r.EIP712_SIGN&&(Y.signatureType=r.EIP712_SIGN),e.next=72,oe(r,S,b,Y,a);case 72:e.next=83;break;case 74:for(q=0;q<I.length;q++)R.push(ne(I[q]));return(H={}).from=S,H.apiId=b.id,H.params=R,H.gasLimit=u.gasLimit.toString(),H.to=u.to.toLowerCase(),e.next=83,oe(r,S,b,H,a);case 83:e.next=86;break;case 85:s?((J={}).token=y.DEFAULT_RELAYER_PAYMENT_TOKEN_ADDRESS,J.amount=y.DEFAULT_RELAYER_PAYMENT_AMOUNT,(K={}).rawTx=o,K.signature=s,K.to=l,K.from=S,K.apiId=b.id,K.data=u.data,K.value=m.utils.hexValue(u.value),K.gasLimit=u.gasLimit.toString(),K.nonceBatchId=y.NONCE_BATCH_ID,K.expiry=y.EXPIRY,K.baseGas=y.BASE_GAS,K.relayerPayment={token:J.token,amount:J.amount},oe(r,S,b,K,a)):(z=he(k.INVALID_PAYLOAD,"Invalid payload data ".concat(JSON.stringify(t.params[0]),". message and signature are required in param object")),j.emit(x.BICONOMY_ERROR,z),a(z));case 86:e.next=91;break;case 88:X=he(k.INVALID_PAYLOAD,"Not able to deode the data in rawTransaction using ethereum-tx-decoder. Please check the data sent."),j.emit(x.BICONOMY_ERROR,X),a(X);case 91:e.next=96;break;case 93:$=he(k.INVALID_PAYLOAD,"Invalid payload data ".concat(JSON.stringify(t.params[0]),".rawTransaction is required in param object")),j.emit(x.BICONOMY_ERROR,$),a($);case 96:e.next=101;break;case 98:Q=he(k.INVALID_PAYLOAD,"Invalid payload data ".concat(JSON.stringify(t.params[0]),". Non empty Array expected in params key")),j.emit(x.BICONOMY_ERROR,Q),a(Q);case 101:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,r,t){return $.apply(this,arguments)}function $(){return($=(0,l.default)(f.default.mark((function e(r,t,n){var o,s,i,c,u,p,l,h,g,w,v,b,A,E,P,I,R,N,S,D,_,M,B,F,L,G,q,H,J,K,z,X,$;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me("Handle transaction with payload"),me(t),!(t.params&&t.params[0]&&t.params[0].to)){e.next=136;break}if(o=t.params[0].to.toLowerCase(),!Y[o]&&!Y[y.SCW]){e.next=126;break}if((s=V(o,t.params[0].data))||(s=V(y.SCW,t.params[0].data)),s){e.next=12;break}return(i={}).code=k.WRONG_ABI,i.message="Can't decode method information from payload. Make sure you have uploaded correct ABI on Biconomy Dashboard",e.abrupt("return",n(i,null));case 12:if(c=s.name,(u=r.dappAPIMap[o]?r.dappAPIMap[o][c]:void 0)?(l=u.contractAddress.toLowerCase(),p=U[l]):(u=r.dappAPIMap[y.SCW]?r.dappAPIMap[y.SCW][c]:void 0,p=U[y.SCW]),h=t.params[0].gas,g=t.params[0].signatureType,me(t.params[0]),me(u),me("gas limit : ".concat(h)),u){e.next=32;break}if(me("API not found for method ".concat(c)),me("Strict mode ".concat(r.strictMode)),!r.strictMode){e.next=30;break}return(w={}).code=k.API_NOT_FOUND,w.message="Biconomy strict mode is on. No registered API found for method ".concat(c,". Please register API from developer dashboard."),e.abrupt("return",n(w,null));case 30:return me("Falling back to default provider as strict mode is false in biconomy"),e.abrupt("return",Z(r,t,n,"No registered API found for method ".concat(c,". Please register API from developer dashboard.")));case 32:if(me("API found"),me("Getting user account"),v=t.params[0].from){e.next=37;break}return e.abrupt("return",n("Not able to get user account"));case 37:if(me("User account fetched"),me(b=s.params),A=[],p!=r.ERC20_FORWARDER){e.next=45;break}return E=he(k.INVALID_PAYLOAD,'This operation is not allowed for contracts registered on dashboard as "ERC20Forwarder". Use ERC20Forwarder client instead!'),j.emit(x.BICONOMY_ERROR,E),e.abrupt("return",n(E));case 45:if(u.url!=O){e.next=121;break}if(p!=r.TRUSTED_FORWARDER){e.next=111;break}for(me("Smart contract is configured to use Trusted Forwarder as meta transaction type"),P=t.params[0].data,R=t.params[0].signature,N=[],S=0;S<b.length;S++)N.push(ne(b[S]));if(!(D=W[o])){e.next=61;break}return M=new m.Contract(o,JSON.parse(D),r.ethersProvider),e.next=57,(_=M.estimateGas)[c].apply(_,N.concat([{from:v}]));case 57:I=e.sent,me("Gas limit calculated for method ".concat(c," in SDK: ").concat(I)),e.next=64;break;case 61:B=he(k.SMART_CONTRACT_NOT_FOUND,"Smart contract ABI not found!"),j.emit(x.BICONOMY_ERROR,B),n(B);case 64:return e.next=66,T(v,o,parseInt(I),P,a);case 66:if(me(F=e.sent.request),A.push(F),!g||g!=r.EIP712_SIGN){e.next=86;break}if(L=C(d),me("Domain separator to be used:"),me(L),A.push(L),!R){e.next=79;break}me("EIP712 signature from payload is ".concat(G=R)),e.next=83;break;case 79:return e.next=81,ee(r,v,F);case 81:G=e.sent,me("EIP712 signature is ".concat(G));case 83:A.push(G),e.next=100;break;case 86:if(!R){e.next=91;break}me("Personal signature from payload is ".concat(q=R)),e.next=95;break;case 91:return e.next=93,re(r,F);case 93:q=e.sent,me("Personal signature is ".concat(q));case 95:if(!q){e.next=99;break}A.push(q),e.next=100;break;case 99:throw new Error("Could not get personal signature while processing transaction in Mexa SDK. Please check the providers you have passed to Biconomy");case 100:return(H={}).from=v,H.apiId=u.id,H.params=A,H.to=o,H.gasLimit=h,g&&g==r.EIP712_SIGN&&(H.signatureType=r.EIP712_SIGN),e.next=109,oe(r,v,u,H,n);case 109:e.next=119;break;case 111:for(J=0;J<b.length;J++)A.push(ne(b[J]));(K={}).from=v,K.apiId=u.id,K.params=A,K.gasLimit=h,K.to=o,oe(r,v,u,K,n);case 119:e.next=124;break;case 121:return z=he(k.INVALID_OPERATION,'Biconomy smart contract wallets are not supported now. On dashboard, re-register your smart contract methods with "native meta tx" checkbox selected.'),j.emit(x.BICONOMY_ERROR,z),e.abrupt("return",n(z));case 124:e.next=134;break;case 126:if(!r.strictMode){e.next=132;break}X=he(k.BICONOMY_NOT_INITIALIZED,"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard"),j.emit(x.BICONOMY_ERROR,X),n(X),e.next=134;break;case 132:return me("Smart contract not found on dashbaord. Strict mode is off, so falling back to normal transaction mode"),e.abrupt("return",Z(r,t,n,"Current provider can't send transactions and smart contract ".concat(o," not found on Biconomy Dashbaord")));case 134:e.next=139;break;case 136:$=he(k.INVALID_PAYLOAD,"Invalid payload data ".concat(JSON.stringify(t),". Expecting params key to be an array with first element having a 'to' property")),j.emit(x.BICONOMY_ERROR,$),n($);case 139:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,r,t,a){if(e.originalProvider){if(e.canSignMessages)return e.isEthersProviderPresent?e.originalProvider.send(r.method,r.params):e.originalProvider.send(r,t);throw new Error(a)}throw new Error("Original provider not present in Biconomy")}function Q(e){return w.soliditySHA3(["address","address","address","uint256","uint256","uint256","uint256","uint256","bytes32"],[e.from,e.to,e.token,e.txGas,e.tokenGasPrice,e.batchId,e.batchNonce,e.deadline,m.utils.keccak256(e.data)])}function ee(e,r,t){var a=function(e){if(!i||!c||!d)throw new Error("Biconomy is not properly initialized");return JSON.stringify({types:{EIP712Domain:i,ERC20ForwardRequest:c},domain:d,primaryType:"ERC20ForwardRequest",message:e})}(t),n=function(e){var r;if(e&&(r=e.originalProvider,!e.canSignMessages)){if(!e.walletProvider)throw new Error("Please pass a provider connected to a wallet that can sign messages in Biconomy options.");r=e.walletProvider}return r}(e);return new h(function(){var e=(0,l.default)(f.default.mark((function e(t,o){var s;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=12;break}if(!ce(n)){e.next=8;break}return e.next=4,n.send("eth_signTypedData_v3",[r,a]);case 4:s=e.sent,t(s),e.next=10;break;case 8:return e.next=10,n.send({jsonrpc:"2.0",id:999999999999,method:"eth_signTypedData_v3",params:[r,a]},(function(e,r){e?o(e):t(r.result)}));case 10:e.next=13;break;case 12:o("Could not get signature from the provider passed to Biconomy. Check if you have passed a walletProvider in Biconomy Options.");case 13:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}())}function re(e,r){return te.apply(this,arguments)}function te(){return(te=(0,l.default)(f.default.mark((function e(r,t){var a,n,o;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Q(t),r.signer||r.walletProvider){e.next=3;break}throw new Error("Can't sign messages with current provider. Did you forget to pass walletProvider in Biconomy options?");case 3:if(!r.canSignMessages){e.next=9;break}return e.next=6,r.signer.signMessage(m.utils.arrayify(a));case 6:n=e.sent,e.next=22;break;case 9:if(!r.walletProvider){e.next=22;break}return e.next=12,r.walletProvider.getSigner();case 12:return o=e.sent,e.prev=13,e.next=16,o.signMessage(m.utils.arrayify(a));case 16:n=e.sent,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(13),new Error("Can't get signature from Wallet Provider passed to Biconomy options. Make sure wallet provider you have passed can sign messages.");case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,null,[[13,19]])})))).apply(this,arguments)}function ae(e,r,t){if(e){var a="99999999";if(r&&(a=r.id),!t)return new h((function(r,t){e.originalProvider.send({jsonrpc:I,id:a,method:"eth_accounts",params:[]},(function(e,a){e?t(e):a.result?r(a.result[0]):t("Invalid response ".concat(a))}))}));e.originalProvider.send({jsonrpc:I,id:a,method:"eth_accounts",params:[]},(function(e,r){t(e,r)}))}}function ne(e){var r;try{if(e&&e.value){var t=e.type;switch(t){case(t.match(/^uint.*\[\]$/)||t.match(/^int.*\[\]$/)||{}).input:var a=e.value;r=[];for(var n=0;n<a.length;n++)r[n]=ge(a[n]),r[n]&&(r[n]=m.BigNumber.from(r[n]).toHexString());break;case(t.match(/^uint[0-9]*$/)||t.match(/^int[0-9]*$/)||{}).input:(r=ge(e.value))&&(r=m.BigNumber.from(r).toHexString());break;case"string":r="object"===(0,p.default)(e.value)?e.value.toString():e.value;break;default:r=e.value}}return r}catch(e){throw me(e),new Error("Error occured while sanitizing paramters. Please verify your method parameters or contact support")}}function oe(e,r,t,a,n){return se.apply(this,arguments)}function se(){return(se=(0,l.default)(f.default.mark((function e(r,t,a,n,o){var s,i;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&t&&a&&n?(s=a.url,(i=le("POST",r.apiKey)).body=JSON.stringify(n),G("".concat(P).concat(s),i).then((function(e){return e.json()})).then((function(e){if(me(e),e.txHash||e.flag==A.ACTION_COMPLETE||e.flag==A.SUCCESS)o&&o(null,e.txHash);else{var r={};r.code=e.flag||e.code,e.flag==A.USER_CONTRACT_NOT_FOUND&&(r.code=k.USER_CONTRACT_NOT_FOUND),r.message=e.log||e.message,o&&o(r)}})).catch((function(e){me(e),o&&o(e)}))):(me("Invalid arguments, provider: ".concat(r," account: ").concat(t," api: ").concat(a," data: ").concat(n)),o&&o("Invalid arguments, provider: ".concat(r," account: ").concat(t," api: ").concat(a," data: ").concat(n),null));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return(ie=(0,l.default)(f.default.mark((function e(r,t){var a;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.ethersProvider.getSigner();case 3:t.signer=e.sent,a="".concat(P,"/api/").concat(y.version,"/dapp"),G(a,le("GET",r)).then((function(e){return e.json()})).then(function(){var e=(0,l.default)(f.default.mark((function e(a){var n,o,s,i;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me(a),!a||!a.dapp){e.next=20;break}if(n=a.dapp.networkId,o=a.dapp._id,me("Network id corresponding to dapp id ".concat(o," is ").concat(n)),s={jsonrpc:I,id:"102",method:"net_version",params:[]},!ce(t.originalProvider)){e.next=17;break}return e.next=9,t.originalProvider.send("net_version",[]);case 9:if(!(i=e.sent)){e.next=14;break}de(t,{providerNetworkId:i,dappNetworkId:n,apiKey:r,dappId:o}),e.next=15;break;case 14:return e.abrupt("return",j.emit(x.BICONOMY_ERROR,he(k.NETWORK_ID_NOT_FOUND,"Could not get network version"),"Could not get network version"));case 15:e.next=18;break;case 17:t.originalProvider.send(s,(function(e,a){if(e||a&&a.error)return j.emit(x.BICONOMY_ERROR,he(k.NETWORK_ID_NOT_FOUND,"Could not get network version"),e||a.error);var s=a.result;de(t,{providerNetworkId:s,dappNetworkId:n,apiKey:r,dappId:o})}));case 18:e.next=21;break;case 20:a.log?j.emit(x.BICONOMY_ERROR,he(k.ERROR_RESPONSE,a.log)):j.emit(x.BICONOMY_ERROR,he(k.DAPP_NOT_FOUND,"No Dapp Registered with apikey ".concat(r)));case 21:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){j.emit(x.BICONOMY_ERROR,he(k.ERROR_RESPONSE,"Error while initializing Biconomy"),e)})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),j.emit(x.BICONOMY_ERROR,he(k.ERROR_RESPONSE,"Error while initializing Biconomy"),e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function ce(e){return m.providers.Provider.isProvider(e)}function de(e,r){return ue.apply(this,arguments)}function ue(){return(ue=(0,l.default)(f.default.mark((function e(r,u){var p,l,h,g;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=u.providerNetworkId,l=u.dappNetworkId,h=u.apiKey,g=u.dappId,r.networkId=p,me("Current provider network id: ".concat(p)),p==l){e.next=7;break}return e.abrupt("return",j.emit(x.BICONOMY_ERROR,he(k.NETWORK_ID_MISMATCH,"Current networkId ".concat(p," is different from dapp network id registered on mexa dashboard ").concat(l))));case 7:q.chainId=p,H.chainId=p,G("".concat(P,"/api/").concat(y.version2,"/meta-tx/systemInfo?networkId=").concat(p)).then((function(e){return e.json()})).then((function(e){if(!e)return j.emit(x.BICONOMY_ERROR,he(k.INVALID_DATA,"Could not get signature types from server. Contact Biconomy Team"));e.domainType,i=e.forwarderDomainType,e.metaInfoType,e.relayerPaymentType,e.metaTransactionType,e.loginDomainType,e.loginMessageType,e.loginDomainData,c=e.forwardRequestType,d=e.forwarderDomainData,n=e.overHeadEIP712Sign,o=e.overHeadDaiPermit,s=e.overHeadEIP2612Permit,r.forwarderAddress=e.biconomyForwarderAddress,r.erc20ForwarderAddress=e.erc20ForwarderAddress,r.transferHandlerAddress=e.transferHandlerAddress,r.daiTokenAddress=e.daiTokenAddress,r.usdtTokenAddress=e.usdtTokenAddress,r.usdcTokenAddress=e.usdcTokenAddress,r.TRUSTED_FORWARDER=e.trustedForwarderMetaTransaction,r.ERC20_FORWARDER=e.erc20ForwarderMetaTransaction,r.DEFAULT=e.defaultMetaTransaction,r.EIP712_SIGN=e.eip712Sign,r.PERSONAL_SIGN=e.personalSign,r.tokenGasPriceV1SupportedNetworks=e.tokenGasPriceV1SupportedNetworks,H.verifyingContract=r.daiTokenAddress,e.relayHubAddress&&(q.verifyingContract=e.relayHubAddress),r.forwarderAddress&&""!=r.forwarderAddress&&(a=new m.Contract(r.forwarderAddress,F,r.ethersProvider));var u="".concat(P,"/api/").concat(y.version,"/smart-contract");G(u,le("GET",h)).then((function(e){return e.json()})).then((function(e){if(!e&&143!=e.flag)return j.emit(x.BICONOMY_ERROR,he(k.SMART_CONTRACT_NOT_FOUND,"Error getting smart contract for dappId ".concat(g)));var a=e.smartContracts;a&&a.length>0?(a.forEach((function(e){var r=t("1RuX");e.type===y.SCW?(U[y.SCW]=e.metaTransactionType,r.addABI(JSON.parse(e.abi)),Y[y.SCW]=r,W[y.SCW]=e.abi):(U[e.address.toLowerCase()]=e.metaTransactionType,r.addABI(JSON.parse(e.abi)),Y[e.address.toLowerCase()]=r,W[e.address.toLowerCase()]=e.abi)})),me(U),pe(r,g)):r.strictMode?(r.status=E.NO_DATA,j.emit(x.BICONOMY_ERROR,he(k.SMART_CONTRACT_NOT_FOUND,"No smart contract registered for dappId ".concat(g," on Mexa Dashboard")))):pe(r,g)})).catch((function(e){j.emit(x.BICONOMY_ERROR,he(k.ERROR_RESPONSE,"Error while initializing Biconomy"),e)}))}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,r){return fe.apply(this,arguments)}function fe(){return(fe=(0,l.default)(f.default.mark((function e(r,t){return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j.emit(x.SMART_CONTRACT_DATA_READY,t,r);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,r){return{method:e,headers:{"x-api-key":r,"Content-Type":"application/json;charset=utf-8"}}}function he(e,r){return{code:e,message:r}}function me(e){y&&y.logsEnabled&&console.log&&console.log(e)}J.prototype.getSignerByAddress=function(e){var r=this.getEthersProvider().getSigner();return(r=r.connectUnchecked()).getAddress=(0,l.default)(f.default.mark((function r(){return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e);case 1:case"end":return r.stop()}}),r)}))),r},J.prototype.getEthersProvider=function(){return new m.providers.Web3Provider(this)},J.prototype.getForwardRequestAndMessageToSign=function(e,r,t){var n=this;return new h(function(){var o=(0,l.default)(f.default.mark((function o(s,u){var p,l,h,v,b,x,A,E,P,I,O,R,N,S,C,D,_,M,B,F,L,G,Y,j,q,H,J,K,z;return f.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!e){o.next=70;break}if(!((p=g.decodeTx(e)).to&&p.data&&p.value)){o.next=67;break}if(l=p.to.toLowerCase(),h=V(l,p.data)){o.next=9;break}return v=he(k.DASHBOARD_DATA_MISMATCH,"Smart Contract address registered on dashboard is different than what is sent(".concat(p.to,") in current transaction")),t&&t(v),o.abrupt("return",u(v));case 9:if(b=h.name,x=r||n.daiTokenAddress,me(r),(A=n.dappAPIMap[l]?n.dappAPIMap[l][b]:void 0)?(P=A.contractAddress.toLowerCase(),E=U[P]):(A=n.dappAPIMap[y.SCW]?n.dappAPIMap[y.SCW][b]:void 0,E=U[y.SCW]),A){o.next=19;break}return me("API not found for method ".concat(b)),I=he(k.API_NOT_FOUND,"No API found on dashboard for called method ".concat(b)),t&&t(I),o.abrupt("return",u(I));case 19:for(me("API found"),O=h.params,R=[],N=0;N<O.length;N++)R.push(ne(O[N]));if(S=m.utils.parseTransaction(e),C=S.from,me("Signer is ".concat(C)),(D=p.gasLimit)&&0!=parseInt(D)){o.next=38;break}if(!(M=W[l])){o.next=36;break}return F=new m.Contract(l,JSON.parse(M),n.ethersProvider),o.next=33,(B=F.estimateGas)[b].apply(B,R.concat([{from:C}]));case 33:D=o.sent,_=m.BigNumber.from(D.toString()).add(m.BigNumber.from(5e3)).toNumber(),me("Gas limit number ".concat(_));case 36:o.next=39;break;case 38:_=m.BigNumber.from(D.toString()).toNumber();case 39:if(C){o.next=42;break}return L=he(k.ERROR_RESPONSE,"Not able to get user account from signed transaction"),o.abrupt("return",end(L));case 42:if(E!=n.TRUSTED_FORWARDER){o.next=48;break}return o.next=45,T(C,l,_,p.data,a);case 45:G=o.sent.request,o.next=58;break;case 48:if(E!=n.ERC20_FORWARDER){o.next=55;break}return o.next=51,n.erc20ForwarderClient.buildTx({userAddress:C,to:l,txGas:_,data:p.data,token:x});case 51:(j=o.sent)?(G=j.request,Y=j.cost):u(he(k.ERROR_RESPONSE,"Unable to build forwarder request")),o.next=58;break;case 55:return q=he(k.INVALID_OPERATION,"Smart contract is not registered in the dashboard for this meta transaction approach. Kindly use biconomy.getUserMessageToSign"),t&&t(q),o.abrupt("return",u(q));case 58:return me("Forward Request is: "),me(G),H={types:{EIP712Domain:i,ERC20ForwardRequest:c},domain:d,primaryType:"ERC20ForwardRequest",message:G},J=w.soliditySHA3(["address","address","address","uint256","uint256","uint256","uint256","uint256","bytes32"],[G.from,G.to,G.token,G.txGas,G.tokenGasPrice,G.batchId,G.batchNonce,G.deadline,m.utils.keccak256(G.data)]),K={eip712Format:H,personalSignatureFormat:J,request:G,cost:Y},t&&t(null,K),o.abrupt("return",s(K));case 67:return z=he(k.BICONOMY_NOT_INITIALIZED,"Decoders not initialized properly in mexa sdk. Make sure your have smart contracts registered on Mexa Dashboard"),t&&t(z),o.abrupt("return",u(z));case 70:case"end":return o.stop()}}),o)})));return function(e,r){return o.apply(this,arguments)}}())},J.prototype.onEvent=function(e,r){if(e==this.READY||e==this.ERROR||e==this.LOGIN_CONFIRMATION)return j.on(e,r),this;throw he(k.EVENT_NOT_SUPPORTED,"".concat(e," event is not supported."))},J.prototype._createJsonRpcResponse=function(e,r,t){var a={};return a.id=e.id,a.jsonrpc=I,r&&null!=r||t?(r?a.error=r:t&&t.error?a.error=t.error:m.utils.isHexString(t)?a.result=t:a=t,a):(a.error="Unexpected error has occured. Please contact Biconomy Team",a)},j.on(x.SMART_CONTRACT_DATA_READY,(function(e,r){var t="".concat(P,"/api/").concat(y.version,"/meta-api");G(t,le("GET",r.apiKey)).then((function(e){return e.json()})).then((function(e){if(e&&e.listApis){for(var t=e.listApis,a=0;a<t.length;a++){var n=t[a].contractAddress;n?(r.dappAPIMap[n]||(r.dappAPIMap[n]={}),r.dappAPIMap[n][t[a].method]=t[a]):(r.dappAPIMap[y.SCW]||(r.dappAPIMap[y.SCW]={}),r.dappAPIMap[y.SCW][t[a].method]=t[a])}j.emit(x.DAPP_API_DATA_READY,r)}})).catch((function(e){me(e)}))})),j.on(x.HELPER_CLENTS_READY,function(){var e=(0,l.default)(f.default.mark((function e(r){var t,a,c,u,p,l,h,g,w,v,b,y,k,x,A,P;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={apiKey:r.apiKey,dappAPIMap:r.dappAPIMap,decoderMap:Y,signType:{EIP712_SIGN:r.EIP712_SIGN,PERSONAL_SIGN:r.PERSONAL_SIGN}},a=r.isEthersProviderPresent?r.originalProvider:new m.providers.Web3Provider(r.originalProvider),c=a.getSigner(),u=c,p=!0,e.prev=6,e.next=9,c.getAddress();case 9:r.canSignMessages=!0,e.next=18;break;case 12:e.prev=12,e.t0=e.catch(6),me("Given provider does not have accounts information"),u=a,p=!1,r.canSignMessages=!1;case 18:if(l=r.options.erc20ForwarderAddress||r.erc20ForwarderAddress,h=r.options.transferHandlerAddress||r.transferHandlerAddress,!l){e.next=42;break}return g=new m.Contract(l,_,u),e.next=24,g.oracleAggregator();case 24:return w=e.sent,e.next=27,g.feeManager();case 27:return v=e.sent,e.next=30,g.forwarder();case 30:b=e.sent,y=new m.Contract(w,M,u),k=new m.Contract(v,B,u),x=new m.Contract(b,F,u),A=new m.Contract(h,L,u),P=r.tokenGasPriceV1SupportedNetworks,r.permitClient=new R(r,l,r.daiTokenAddress),r.erc20ForwarderClient=new N({forwarderClientOptions:t,networkId:r.networkId,provider:a,forwarderDomainData:d,forwarderDomainType:i,erc20Forwarder:g,transferHandler:A,forwarder:x,oracleAggregator:y,feeManager:k,isSignerWithAccounts:p,tokenGasPriceV1SupportedNetworks:P,trustedForwarderOverhead:n,daiPermitOverhead:o,eip2612PermitOverhead:s}),me(r.permitClient),me(r.erc20ForwarderClient),e.next=43;break;case 42:me("ERC20 Forwarder is not supported for this network");case 43:r.status=E.BICONOMY_READY,j.emit(E.BICONOMY_READY),e.next=50;break;case 47:e.prev=47,e.t1=e.catch(0),me(e.t1);case 50:case"end":return e.stop()}}),e,null,[[0,47],[6,12]])})));return function(r){return e.apply(this,arguments)}}()),j.on(x.DAPP_API_DATA_READY,(function(e){j.emit(x.HELPER_CLENTS_READY,e)})),J.prototype.isReady=function(){return this.status===E.BICONOMY_READY},J.prototype.getUserAccount=(0,l.default)(f.default.mark((function e(){return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(this);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));var ge=function(e){var r=Math.sign(e);if(e=Math.abs(e),/\d+\.?\d*e[\+\-]*\d+/i.test(e)){var t=String(e).toLowerCase().split("e"),a=t.pop(),n=Math.abs(a),o=a/n,s=t[0].split(".");if(-1===o)e=(n-=s[0].length)<0?s[0].slice(0,n)+"."+s[0].slice(n)+(2===s.length?s[1]:""):"0."+new Array(n+1).join("0")+s.join("");else{var i=s[1];i&&(n-=i.length),e=n<0?s[0]+i.slice(0,n)+"."+i.slice(n):s.join("")+new Array(n+1).join("0")}}return(r<0?"-"+e:e).toString()};e.exports=J},svOm:function(e,r,t){"use strict";var a=t("TqRt"),n=a(t("lwsE")),o=a(t("W8MJ")),s=a(t("o0o1")),i=a(t("yXPU")),c=t("5h+m").ethers,d=t("7U23").config,u=t("ga3E"),p=t("EJgX"),f=p.tokenAbi,l=(p.erc20Eip2612Abi,d.forwardRequestType),h=function(){var e=(0,i.default)(s.default.mark((function e(r){var t,a,n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(d.baseURL,"/api/v1/gas-price?networkId=").concat(r),e.prev=1,e.next=4,fetch(t);case 4:if(!(a=e.sent)||!a.json){e.next=12;break}return e.next=8,a.json();case 8:if(n=e.sent,m("Gas Price Response JSON "+JSON.stringify(n)),!(n&&n.gasPrice&&n.gasPrice.value)){e.next=12;break}return e.abrupt("return",c.utils.parseUnits(n.gasPrice.value.toString(),"gwei").toString());case 12:throw new Error("Error getting gas price from url ".concat(t));case 15:throw e.prev=15,e.t0=e.catch(1),m(e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(r){return e.apply(this,arguments)}}();function m(e){d&&d.logsEnabled&&console.log&&console.log(e)}var g=function(){function e(r){var t=r.forwarderClientOptions,a=r.networkId,o=r.provider,s=r.forwarderDomainData,i=r.forwarderDomainType,c=r.erc20Forwarder,d=r.transferHandler,u=r.forwarder,p=r.oracleAggregator,f=r.feeManager,l=r.isSignerWithAccounts,h=r.tokenGasPriceV1SupportedNetworks,m=r.trustedForwarderOverhead,g=r.daiPermitOverhead,w=r.eip2612PermitOverhead;(0,n.default)(this,e),this.biconomyAttributes=t,this.networkId=a,this.provider=o,this.forwarderDomainData=s,this.forwarderDomainType=i,this.erc20Forwarder=c,this.oracleAggregator=p,this.feeManager=f,this.forwarder=u,this.transferHandler=d,this.isSignerWithAccounts=l,this.tokenGasPriceV1SupportedNetworks=h,this.trustedForwarderOverhead=m,this.daiPermitOverhead=g,this.eip2612PermitOverhead=w}var r,t,a,p,g,w,v,b;return(0,o.default)(e,[{key:"checkTokenSupport",value:(b=(0,i.default)(s.default.mark((function e(r){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.utils.isAddress(r)){e.next=2;break}throw new Error('"token" address '.concat(r," is not a valid ethereum address"));case 2:if(this.feeManager){e.next=4;break}throw new Error("Biconomy Fee Manager contract is not initialized properly.");case 4:return e.next=6,this.feeManager.getTokenAllowed(r);case 6:if(e.sent){e.next=9;break}throw new Error("Token with address ".concat(r," is not supported. Please refer https://docs.biconomy.io to see list of supported tokens"));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"getApiId",value:function(e){try{if(!this.biconomyAttributes)throw new Error("Biconomy is not initialized properly. 'biconomyAttributes'  is missing in ERC20ForwarderClient");if(!this.biconomyAttributes.decoderMap)throw new Error("Biconomy is not initialized properly. 'decoderMap' is missing in ERC20ForwarderClient.biconomyAttributes");if(!e||!e.to||!e.data)throw new Error("'to' and 'data' field is mandatory in the request object parameter");var r=this.biconomyAttributes.decoderMap[e.to.toLowerCase()];if(r){var t=r.decodeMethod(e.data),a=this.biconomyAttributes.dappAPIMap[e.to.toLowerCase()];if(t&&t.name){if(a)return this.biconomyAttributes.dappAPIMap[e.to.toLowerCase()][t.name.toString()];throw new Error("Method ".concat(t.name," is not registerd on Biconomy Dashboard. Please refer https://docs.biconomy.io to see how to register smart contract methods on dashboard."))}throw new Error("Unable to decode the method. The method you are calling might not be registered on Biconomy dashboard. Please check.")}throw new Error("Your smart contract with address ".concat(e.to," might not be registered on Biconomy dashboard. Please check."))}catch(e){throw m(e),e}}},{key:"getTokenGasPrice",value:(v=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,u,p,f;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=this.networkId,n=-1!=this.tokenGasPriceV1SupportedNetworks.indexOf(parseInt(a)),c.utils.isAddress(r)){e.next=5;break}throw new Error("Invalid token address: ".concat(r," Please passs a valid ethereum address"));case 5:if(this.oracleAggregator){e.next=7;break}throw new Error("Oracle Aggregator contract is not initialized properly");case 7:return e.t0=c.BigNumber,e.next=10,h(this.networkId);case 10:if(e.t1=e.sent,null!=(o=e.t0.from.call(e.t0,e.t1))&&0!=o){e.next=14;break}throw new Error("Invalid gasPrice value ".concat(o,". Unable to fetch gas price."));case 14:if(n){e.next=36;break}return e.prev=15,t="".concat(d.baseURL,"/api/v1/token-gas-price?tokenAddress=").concat(r,"&networkId=").concat(a),e.next=19,fetch(t);case 19:if(!(i=e.sent)||!i.json){e.next=29;break}return e.next=23,i.json();case 23:if(u=e.sent,m("Token Gas Price Response JSON "+JSON.stringify(u)),!(u&&u.tokenGasPrice&&u.tokenGasPrice.value)){e.next=27;break}return e.abrupt("return",u.tokenGasPrice.value.toString());case 27:e.next=30;break;case 29:throw new Error("Error getting gas price from url ".concat(t));case 30:e.next=36;break;case 32:throw e.prev=32,e.t2=e.catch(15),m(e.t2),e.t2;case 36:return e.next=38,this.oracleAggregator.getTokenPrice(r);case 38:return p=e.sent,e.next=41,this.oracleAggregator.getTokenOracleDecimals(r);case 41:if(f=e.sent,p&&f){e.next=44;break}throw new Error("Invalid tokenPrice ".concat(p," or tokenOracleDecimals ").concat(f," from oracle aggregator contract"));case 44:return e.abrupt("return",o.mul(c.BigNumber.from(10).pow(f)).div(p).toString());case 47:throw e.prev=47,e.t3=e.catch(0),m(e.t3),new Error("Error getting token gas price inside SDK");case 51:case"end":return e.stop()}}),e,this,[[0,47],[15,32]])}))),function(e){return v.apply(this,arguments)})},{key:"buildTx",value:(w=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,u,p,l,h,g,w,v,b,y,k,x,A,E,P,I,O,R,N,S,T;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.to,a=r.token,n=r.txGas,o=r.data,i=r.batchId,u=void 0===i?0:i,p=r.deadlineInSec,l=void 0===p?3600:p,h=r.userAddress,g=r.permitType,e.prev=1,this.forwarder){e.next=4;break}throw new Error("Biconomy Forwarder contract is not initialized properly.");case 4:if(this.feeManager){e.next=6;break}throw new Error("Biconomy Fee Manager contract is not initialized properly.");case 6:if(this.oracleAggregator){e.next=8;break}throw new Error("Biconomy Oracle Aggregator contract is not initialized properly.");case 8:if(this.erc20Forwarder){e.next=10;break}throw new Error("Biconomy Fee Proxy contract is not initialized properly.");case 10:if(!g){e.next=13;break}if(!g!=d.DAI&&!g!=d.EIP2612){e.next=13;break}throw new Error("permit type passed is not matching expected possible values");case 13:if(c.utils.isAddress(t)){e.next=15;break}throw new Error('"to" address '.concat(t," is not a valid ethereum address"));case 15:if(c.utils.isAddress(a)){e.next=17;break}throw new Error('"token" address '.concat(a," is not a valid ethereum address"));case 17:if(n){e.next=19;break}throw new Error("'txGas' parameter is mandatory");case 19:if(this.isSignerWithAccounts){e.next=21;break}throw new Error("Provider object passed to Biconomy does not have user account information. Refer to docs or contact Biconomy team to know how to use ERC20ForwarderClient properly");case 21:return e.next=23,this.checkTokenSupport(a);case 23:if(h){e.next=27;break}return e.next=26,this.provider.getSigner().getAddress();case 26:h=e.sent;case 27:return e.next=29,this.forwarder.getNonce(h,u);case 29:return w=e.sent,e.next=32,this.getTokenGasPrice(a);case 32:return v=e.sent,b={from:h,to:t,token:a,txGas:n,tokenGasPrice:v,batchId:u,batchNonce:Number(w),deadline:Math.floor(Date.now()/1e3+l),data:o},e.next=36,this.feeManager.getFeeMultiplier(h,a);case 36:return y=e.sent,e.next=39,this.oracleAggregator.getTokenOracleDecimals(a);case 39:return k=e.sent,e.next=42,this.erc20Forwarder.transferHandlerGas(a);case 42:if(x=e.sent,m("TransferHandler gas from ERC20erc20Forwarder contract is ".concat(x.toString())),null!=y&&null!=k&&null!=x){e.next=46;break}throw new Error("One of the values is undefined. feeMultiplier: ".concat(y," tokenOracleDecimals: ").concat(k," transferHandlerGas: ").concat(x));case 46:return A=new c.Contract(a,f,this.provider),e.next=49,A.decimals();case 49:if(E=e.sent,g&&(I=g==d.DAI?this.daiPermitOverhead:this.eip2612PermitOverhead,O=c.BigNumber.from(I.toString()).mul(c.BigNumber.from(b.tokenGasPrice)).mul(c.BigNumber.from(y.toString())).div(c.BigNumber.from(1e4)),parseFloat(O).toString(),O=(parseFloat(O)/parseFloat(c.BigNumber.from(10).pow(E))).toFixed(3),P=parseFloat(O.toString()),m("Estimated Permit Transaction Fee in token address ".concat(a," is ").concat(P))),R=c.BigNumber.from(b.txGas.toString()).add(c.BigNumber.from(this.trustedForwarderOverhead.toString())).add(x).mul(c.BigNumber.from(b.tokenGasPrice)).mul(c.BigNumber.from(y.toString())).div(c.BigNumber.from(1e4)),N=parseFloat(R).toString(),R=(parseFloat(R)/parseFloat(c.BigNumber.from(10).pow(E))).toFixed(3),S=parseFloat(R.toString()),m("Estimated Transaction Fee in token address ".concat(a," is ").concat(S)),T=S,P&&(T=parseFloat(S+P).toFixed(3)),g){e.next=67;break}return e.next=61,this.erc20ForwarderApproved(b.token,h,N);case 61:if(e.sent){e.next=66;break}throw new Error("You have not given approval to ERC Forwarder contract to spend tokens");case 66:m("".concat(h," has given permission ").concat(this.erc20Forwarder.address," to spend required amount of tokens"));case 67:return e.abrupt("return",{request:b,cost:T});case 70:throw e.prev=70,e.t0=e.catch(1),m(e.t0),e.t0;case 74:case"end":return e.stop()}}),e,this,[[1,70]])}))),function(e){return w.apply(this,arguments)})},{key:"buildTransferTx",value:(g=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,c;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.token,a=r.to,n=r.amount,o=r.userAddress,e.prev=1,e.next=4,this.transferHandler.populateTransaction.transfer(t,a,n);case 4:if(i=e.sent,o){e.next=9;break}return e.next=8,this.provider.getSigner().getAddress();case 8:o=e.sent;case 9:return e.next=11,this.provider.estimateGas({from:o,to:this.transferHandler.address,data:i.data});case 11:return c=e.sent,m("Transfer handler gas limit is ".concat(c.toNumber())),e.next=15,this.buildTx({to:this.transferHandler.address,token:t,txGas:c.toNumber(),data:i.data});case 15:return e.abrupt("return",e.sent);case 18:throw e.prev=18,e.t0=e.catch(1),m(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[1,18]])}))),function(e){return g.apply(this,arguments)})},{key:"erc20ForwarderApproved",value:(p=(0,i.default)(s.default.mark((function e(r,t,a){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.Contract(r,f,this.provider.getSigner()),a=Number(a),e.next=4,n.allowance(t,this.erc20Forwarder.address);case 4:if(!(e.sent>a)){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this)}))),function(e,r,t){return p.apply(this,arguments)})},{key:"sendTxEIP712",value:(a=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,u,p,f,h,g,w;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.req,a=r.signature,n=void 0===a?null:a,o=r.userAddress,e.prev=1,i=c.utils.keccak256(c.utils.defaultAbiCoder.encode(["bytes32","bytes32","bytes32","address","bytes32"],[c.utils.id("EIP712Domain(string name,string version,address verifyingContract,bytes32 salt)"),c.utils.id(this.forwarderDomainData.name),c.utils.id(this.forwarderDomainData.version),this.forwarderDomainData.verifyingContract,this.forwarderDomainData.salt])),!this.isSignerWithAccounts){e.next=9;break}return e.next=6,this.provider.getSigner().getAddress();case 6:o=e.sent,e.next=11;break;case 9:if(n){e.next=11;break}throw new Error("Either pass signature param or pass a provider to Biconomy with user accounts information");case 11:if(o){e.next=13;break}throw new Error("Either pass userAddress param or pass a provider to Biconomy with user accounts information");case 13:if(u={types:{EIP712Domain:this.forwarderDomainType,ERC20ForwardRequest:l},domain:this.forwarderDomainData,primaryType:"ERC20ForwardRequest",message:t},null!=n){e.next=20;break}return e.next=17,this.provider.send("eth_signTypedData_v3",[t.from,JSON.stringify(u)]);case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0=n;case 21:if(p=e.t0,(f=this.getApiId(t))&&f.id){e.next=25;break}throw new Error("Could not find the method information on Biconomy Dashboard. Check if you have registered your method on the Dashboard.");case 25:return h=f.id,g={to:t.to,from:o,apiId:h,params:[t,i,p],signatureType:this.biconomyAttributes.signType.EIP712_SIGN},e.next=29,fetch("".concat(d.baseURL,"/api/v2/meta-tx/native"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.biconomyAttributes.apiKey},body:JSON.stringify(g)});case 29:return w=e.sent,e.next=32,w.json();case 32:return e.abrupt("return",e.sent);case 35:throw e.prev=35,e.t1=e.catch(1),m(e.t1),e.t1;case 39:case"end":return e.stop()}}),e,this,[[1,35]])}))),function(e){return a.apply(this,arguments)})},{key:"permitAndSendTxEIP712",value:(t=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,u,p,f,h,g,w,v;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.req,a=r.signature,n=void 0===a?null:a,o=r.userAddress,i=r.metaInfo,e.prev=1,u=c.utils.keccak256(c.utils.defaultAbiCoder.encode(["bytes32","bytes32","bytes32","address","bytes32"],[c.utils.id("EIP712Domain(string name,string version,address verifyingContract,bytes32 salt)"),c.utils.id(this.forwarderDomainData.name),c.utils.id(this.forwarderDomainData.version),this.forwarderDomainData.verifyingContract,this.forwarderDomainData.salt])),!this.isSignerWithAccounts){e.next=9;break}return e.next=6,this.provider.getSigner().getAddress();case 6:o=e.sent,e.next=11;break;case 9:if(n){e.next=11;break}throw new Error("Either pass signature param or pass a provider to Biconomy with user accounts information");case 11:if(o){e.next=13;break}throw new Error("Either pass userAddress param or pass a provider to Biconomy with user accounts information");case 13:if(p={types:{EIP712Domain:this.forwarderDomainType,ERC20ForwardRequest:l},domain:this.forwarderDomainData,primaryType:"ERC20ForwardRequest",message:t},null!=n){e.next=20;break}return e.next=17,this.provider.send("eth_signTypedData_v3",[t.from,JSON.stringify(p)]);case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0=n;case 21:if(f=e.t0,(h=this.getApiId(t))&&h.id){e.next=25;break}throw new Error("Could not find the method information on Biconomy Dashboard. Check if you have registered your method on the Dashboard.");case 25:return g=h.id,w={to:t.to,from:o,apiId:g,params:[t,u,f],metaInfo:i,signatureType:this.biconomyAttributes.signType.EIP712_SIGN},e.next=29,fetch("".concat(d.baseURL,"/api/v2/meta-tx/native"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.biconomyAttributes.apiKey},body:JSON.stringify(w)});case 29:return v=e.sent,e.next=32,v.json();case 32:return e.abrupt("return",e.sent);case 35:throw e.prev=35,e.t1=e.catch(1),m(e.t1),e.t1;case 39:case"end":return e.stop()}}),e,this,[[1,35]])}))),function(e){return t.apply(this,arguments)})},{key:"sendTxPersonalSign",value:(r=(0,i.default)(s.default.mark((function e(r){var t,a,n,o,i,p,f,l,h,g,w;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.req,a=r.signature,n=void 0===a?null:a,o=r.userAddress,e.prev=1,i=u.soliditySHA3(["address","address","address","uint256","uint256","uint256","uint256","uint256","bytes32"],[t.from,t.to,t.token,t.txGas,t.tokenGasPrice,t.batchId,t.batchNonce,t.deadline,c.utils.keccak256(t.data)]),p=this.provider.getSigner(),!this.isSignerWithAccounts){e.next=10;break}return e.next=7,p.getAddress();case 7:o=e.sent,e.next=12;break;case 10:if(n){e.next=12;break}throw new Error("Either pass signature param or pass a provider to Biconomy with user accounts information");case 12:if(o){e.next=14;break}throw new Error("Either pass userAddress param or pass a provider to Biconomy with user accounts information");case 14:if(null!=n||!this.isSignerWithAccounts){e.next=20;break}return e.next=17,p.signMessage(i);case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0=n;case 21:if(null!=(f=e.t0)&&null!=f){e.next=24;break}throw new Error("Either pass signature param or pass a provider to Biconomy with user accounts information");case 24:if((l=this.getApiId(t))&&l.id){e.next=27;break}throw new Error("Could not find the method information on Biconomy Dashboard. Check if you have registered your method on the Dashboard.");case 27:return h=l.id,g={to:t.to,from:o,apiId:h,params:[t,f],signatureType:this.biconomyAttributes.signType.PERSONAL_SIGN},e.next=31,fetch("".concat(d.baseURL,"/api/v2/meta-tx/native"),{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.biconomyAttributes.apiKey},body:JSON.stringify(g)});case 31:return w=e.sent,e.next=34,w.json();case 34:return e.abrupt("return",e.sent);case 37:throw e.prev=37,e.t1=e.catch(1),m(e.t1),e.t1;case 41:case"end":return e.stop()}}),e,this,[[1,37]])}))),function(e){return r.apply(this,arguments)})}]),e}();e.exports=g}}]);